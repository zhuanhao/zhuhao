<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<!-- 1. å¼€å¯â€œçœŸÂ·å…¨å±â€æ¨¡å¼çš„å…³é”®ä»£ç  -->
<!-- viewport-fit=cover è®©å†…å®¹å»¶ä¼¸åˆ°å®‰å…¨åŒºåŸŸå¤–ï¼Œé€‚é…åˆ˜æµ·å± -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<!-- iOS æ·»åŠ åˆ°ä¸»å±å¹•åå…¨å±æ˜¾ç¤º (éšè— Safari åœ°å€æ ) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<!-- iOS çŠ¶æ€æ æ ·å¼ï¼Œblack-translucent è¡¨ç¤ºå†…å®¹ä¼šå»¶ä¼¸åˆ°çŠ¶æ€æ ä¸‹æ–¹ -->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Android Chrome æ·»åŠ åˆ°ä¸»å±å¹•åå…¨å±æ˜¾ç¤º (éšè— Chrome åœ°å€æ ) -->
<meta name="mobile-web-app-capable" content="yes">

<!-- PWA Manifest é“¾æ¥ï¼šé‡è¦ï¼å®ƒå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•å°†ä½ çš„ç½‘ç«™è§†ä¸ºApp -->
<!-- è¿™é‡Œçš„è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè¡¨ç¤º manifest.json å’Œ index.html åœ¨åŒä¸€ç›®å½• -->
<link rel="manifest" href="./manifest.json"> 
<!-- iOS è®¾å¤‡æ·»åŠ åˆ°ä¸»å±å¹•æ—¶ä½¿ç”¨çš„å›¾æ ‡ï¼šé‡è¦ï¼ -->
<!-- è¿™é‡Œä¹Ÿä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ŒæŒ‡å‘ manifest.json ä¸­å®šä¹‰çš„å›¾æ ‡ä¹‹ä¸€ -->
<link rel="apple-touch-icon" href="./icon-192.png"> 

<title>AI OS</title>
<style>
  /* --- åŸºç¡€é‡ç½® --- */
  * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
  /* html, body å¿…é¡»è®¾ç½®ä¸º 100% é«˜åº¦ä»¥ç¡®ä¿ viewport å¡«å…… */
  html, body { height: 100%; margin: 0; }
  body {
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    /* ä½¿ç”¨ 100dvh (æˆ– 100vh) æ¥ç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå æ®æ•´ä¸ªè§†å£é«˜åº¦ */
    min-height: 100dvh; /* ç°ä»£æµè§ˆå™¨æ¨èä½¿ç”¨dvh */
    font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    overflow: hidden;
  }

  /* --- æ‰‹æœºå®¹å™¨ --- */
  .phone-frame {
    width: 100%; height: 100%; max-width: 420px;
    background: #000; position: relative; overflow: hidden;
  }

  /* --- å±å¹•å£çº¸ --- */
  .screen {
    width: 100%; height: 100%;
    background: url('https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?q=80&w=1000&auto=format&fit=crop') center/cover;
    position: relative; display: flex; flex-direction: column;
    transition: filter 0.3s;
  }

  /* --- é¡¶éƒ¨çŠ¶æ€æ  (é‡åš) --- */
  .status-bar {
    position: absolute; top: 0; left: 0; right: 0;
    height: 48px; display: flex; justify-content: space-between; align-items: flex-end;
    /* é¡¶éƒ¨å¡«å……ä½¿ç”¨ env() ç¡®ä¿é¿å¼€åˆ˜æµ· */
    padding: calc(10px + env(safe-area-inset-top)) 24px 10px;
    color: white; font-size: 15px; font-weight: 600; z-index: 100;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  .carrier-name { font-size: 14px; font-weight: 500; }
  
  /* ç²¾è‡´ç”µæ± å›¾æ ‡ç»˜åˆ¶ */
  .battery-container {
    display: flex; align-items: center; gap: 6px;
  }
  .battery-icon {
    width: 26px; height: 12px;
    border: 2px solid rgba(255,255,255,0.8);
    border-radius: 3px;
    position: relative;
    padding: 1px;
  }
  .battery-icon::after {
    content: ''; position: absolute; right: -4px; top: 2px;
    width: 2px; height: 4px; background: rgba(255,255,255,0.8);
    border-radius: 0 2px 2px 0;
  }
  .battery-level {
    height: 100%;
    background: white;
    border-radius: 1px;
    width: 60%;
    transition: width 0.5s;
  }
  .charging-bolt { display: none; font-size: 10px; }
  .charging .charging-bolt { display: block; }
  .charging .battery-level { background: #34c759; }

  /* --- çµåŠ¨å²› (åŠ¨æ•ˆä¼˜åŒ–) --- */
  .dynamic-island {
    position: absolute; 
    top: calc(11px + env(safe-area-inset-top)); 
    left: 50%; transform: translateX(-50%);
    width: 110px; height: 32px; background: #000; border-radius: 20px; z-index: 101;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex; justify-content: center; align-items: center;
    color: white; font-size: 14px; overflow: hidden;
  }
  .dynamic-island.expanded {
    width: 90%;
    max-width: 360px;
    height: 56px;
    border-radius: 30px;
    justify-content: flex-start;
    padding: 0 15px;
    gap: 10px;
  }
  .dynamic-island img.album-art {
    width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0;
    display: none;
  }
  .dynamic-island.expanded img.album-art {
    display: block;
  }
  .dynamic-island .text-content {
    flex-grow: 1;
    display: none;
    flex-direction: column;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .dynamic-island.expanded .text-content {
    display: flex;
  }
  .dynamic-island .title { font-weight: 600; font-size: 15px; }
  .dynamic-island .artist { font-size: 12px; opacity: 0.7; }
  .dynamic-island .controls {
    display: none;
    gap: 15px;
    font-size: 20px;
  }
  .dynamic-island.expanded .controls {
    display: flex;
  }

  /* --- é¡µé¢åˆ‡æ¢é€»è¾‘ --- */
  .page {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #fff; display: none; flex-direction: column;
    transform-origin: center bottom;
    padding-top: calc(48px + env(safe-area-inset-top)); /* çŠ¶æ€æ é«˜åº¦ + å®‰å…¨åŒºåŸŸ */
    padding-bottom: calc(5px + 8px + env(safe-area-inset-bottom)); /* home-baré«˜åº¦ + home-baråº•éƒ¨è·ç¦» + å®‰å…¨åŒºåŸŸ */
  }
  /* é”å±é¡µç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºå®ƒèƒŒæ™¯é€æ˜ï¼Œä¸”æ—¶é’Ÿä½ç½®ä¸åŒ */
  #lock-screen {
    background: transparent; align-items: center; color: white;
    padding-top: calc(120px + env(safe-area-inset-top)); /* è°ƒæ•´æ—¶é’Ÿä½ç½® */
    padding-bottom: calc(50px + env(safe-area-inset-bottom)); /* è°ƒæ•´è§£é”æç¤ºä½ç½® */
    z-index: 50; text-align: center;
  }
  /* æ¡Œé¢é¡µç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºå®ƒèƒŒæ™¯é€æ˜ï¼Œä¸”æœ‰è‡ªå·±çš„å¸ƒå±€ */
  #home-screen { 
    background: transparent; 
    padding-top: calc(70px + env(safe-area-inset-top)); 
    padding-bottom: calc(20px + env(safe-area-inset-bottom)); 
    z-index: 40; 
  }

  .page.active { display: flex; animation: appOpen 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
  @keyframes appOpen { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

  /* --- 1. é”å± --- */
  .clock-large { font-size: 86px; font-weight: 200; letter-spacing: -2px; line-height: 1; }
  .date-text { font-size: 20px; margin-top: 10px; font-weight: 500; opacity: 0.9; }
  .unlock-hint { margin-top: auto; opacity: 0.6; font-size: 14px; animation: pulse 2s infinite; }
  @keyframes pulse { 0% {opacity:0.3} 50% {opacity:0.8} 100% {opacity:0.3} }

  /* --- 2. æ¡Œé¢ --- */
  .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; row-gap: 30px; }
  .app-item { display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.1s;}
  .app-item:active { opacity: 0.6; transform: scale(0.95); }
  
  .app-icon { 
    width: 60px; height: 60px; border-radius: 16px; 
    display: flex; justify-content: center; align-items: center; 
    font-size: 28px; color: white; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
  }
  .app-icon.camera { background: linear-gradient(135deg, #ff5722, #ff9800); }
  .app-icon.phone { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
  .app-icon.browser { background: linear-gradient(135deg, #2196F3, #03A9F4); }
  .app-icon.music { background: linear-gradient(135deg, #9C27B0, #E040FB); }
  .app-icon.mail { background: linear-gradient(135deg, #F44336, #FF7043); }

  .app-name { color: white; font-size: 12px; font-weight: 500; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
  
  .dock {
    margin-top: auto; background: rgba(255,255,255,0.25); backdrop-filter: blur(20px);
    border-radius: 32px; padding: 18px; display: flex; justify-content: space-around; 
    margin-bottom: env(safe-area-inset-bottom); /* ç¡®ä¿ dock ä¸ä¼šè¢«æ‰‹åŠ¿æ¡é®æŒ¡ */
    width: 100%; box-sizing: border-box;
  }
  .dock .app-item {
    margin: 0; 
    flex-basis: 25%; 
  }
  .dock .app-item .app-icon {
    width: 50px; height: 50px; font-size: 24px;
  }
  .dock .app-item .app-name {
    margin-top: 5px; 
  }

  /* --- 3. App å†…éƒ¨æ ·å¼ --- */
  .app-header { 
    position: absolute; top: 0; left: 0; right: 0; 
    height: 96px; 
    padding: calc(50px + env(safe-area-inset-top)) 20px 10px; 
    background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.1); 
    font-weight: 700; font-size: 22px; 
    display: flex; align-items: center; justify-content: space-between;
    z-index: 10;
  }
  .app-content { 
    flex: 1; overflow-y: auto; padding: 20px; background: #f2f2f7; 
  }

  /* èŠå¤©æ°”æ³¡ */
  .chat-bubble { padding: 12px 18px; border-radius: 20px; max-width: 85%; margin-bottom: 12px; font-size: 16px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
  .chat-bubble.ai { background: #fff; align-self: flex-start; border-bottom-left-radius: 4px; }
  .chat-bubble.me { background: #007aff; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
  
  /* åº•éƒ¨è¾“å…¥æ¡† */
  .input-area { 
    position: absolute; bottom: 0; left: 0; right: 0; 
    padding: 12px 15px calc(30px + env(safe-area-inset-bottom)) 15px; 
    background: #fff; display: flex; gap:10px; border-top: 1px solid #eee; 
    z-index: 10;
  }
  .input-area input { flex: 1; height: 40px; padding: 0 15px; border: 1px solid #e0e0e0; border-radius: 20px; font-size: 16px; outline: none; background: #f5f5f5; }
  .input-area input:focus { background: #fff; border-color: #007aff; }

  /* æ–°å¢ï¼šè®¾ç½®é¡µé¢å¼€å…³æ ·å¼ */
  .toggle-switch {
    width: 50px; height: 30px; background: #e9e9ea; border-radius: 15px; position: relative;
    transition: background-color 0.3s;
  }
  .toggle-switch.on { background-color: #34c759; }
  .toggle-switch .slider {
    width: 26px; height: 26px; background: white; border-radius: 50%; position: absolute;
    top: 2px; left: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: left 0.3s;
  }
  .toggle-switch.on .slider { left: 22px; }

  /* åº•éƒ¨é»‘æ¡ */
  .home-bar {
    position: absolute; left: 50%; transform: translateX(-50%);
    width: 130px; height: 5px; background: #fff; border-radius: 3px; z-index: 999; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    bottom: calc(8px + env(safe-area-inset-bottom)); 
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar">
      <span class="carrier-name">AI_Link</span>
      <span id="clock-small">--:--</span>
      <div class="battery-container" id="battery-box">
        <span class="charging-bolt">âš¡</span>
        <span id="batt-text" style="font-size:12px; margin-right:4px;"></span>
        <div class="battery-icon">
          <div class="battery-level" id="batt-level"></div>
        </div>
      </div>
    </div>
    
    <!-- çµåŠ¨å²› -->
    <div class="dynamic-island" id="dynamic-island-display" onclick="toggleDynamicIsland()">
      <img src="https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ" alt="Album Art" class="album-art" id="album-art">
      <div class="text-content">
        <div class="title" id="song-title">æ­Œæ›²åç§°</div>
        <div class="artist" id="song-artist">è‰ºæœ¯å®¶</div>
      </div>
      <div class="controls">
        <span onclick="event.stopPropagation(); console.log('Previous Track')">â®</span>
        <span onclick="event.stopPropagation(); togglePlayPause()" id="play-pause-btn">â¯</span>
        <span onclick="event.stopPropagation(); console.log('Next Track')">â­</span>
      </div>
    </div>

    <!-- 1. é”å± -->
    <div id="lock-screen" class="page active" onclick="unlock()">
      <div>
        <div class="clock-large" id="clock-large">12:00</div>
        <div class="date-text" id="date-text">10æœˆ24æ—¥ æ˜ŸæœŸäºŒ</div>
      </div>
      <div class="unlock-hint">å‘ä¸Šæ»‘åŠ¨è§£é”</div>
    </div>

    <!-- 2. æ¡Œé¢ -->
    <div id="home-screen" class="page">
      <div class="app-grid">
        <div class="app-item" onclick="openApp('app-chat')">
          <div class="app-icon" style="background: linear-gradient(135deg, #30cfd0, #330867);">ğŸ’¬</div>
          <span class="app-name">AI äº¤æµ</span>
        </div>
        <div class="app-item" onclick="openApp('app-lore')">
          <div class="app-icon" style="background: linear-gradient(135deg, #d299c2, #fef9d7);">ğŸ“–</div>
          <span class="app-name">ä¸–ç•Œä¹¦</span>
        </div>
        <div class="app-item" onclick="openApp('app-settings')">
          <div class="app-icon" style="background: linear-gradient(135deg, #a1c4fd, #c2e9fb);">âš™ï¸</div>
          <span class="app-name">è®¾ç½®</span>
        </div>
        <div class="app-item">
          <div class="app-icon camera">ğŸ“·</div>
          <span class="app-name">ç›¸æœº</span>
        </div>
      </div>

      <div class="dock">
        <div class="app-item"><div class="app-icon phone">ğŸ“</div><span class="app-name">ç”µè¯</span></div>
        <div class="app-item"><div class="app-icon browser">ğŸŒ</div><span class="app-name">æµè§ˆå™¨</span></div>
        <div class="app-item"><div class="app-icon music">ğŸµ</div><span class="app-name">éŸ³ä¹</span></div>
        <div class="app-item"><div class="app-icon mail">âœ‰ï¸</div><span class="app-name">é‚®ä»¶</span></div>
      </div>
    </div>

    <!-- 3. App: èŠå¤© -->
    <div id="app-chat" class="page">
      <div class="app-header">
        <span>AI åŠ©æ‰‹</span>
        <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span>
      </div>
      <div class="app-content" id="chat-box" style="display:flex; flex-direction:column;">
        <div class="chat-bubble ai">ä½ å¥½ï¼ç³»ç»Ÿæ—¶é—´å·²åŒæ­¥ã€‚</div>
        <div class="chat-bubble ai">ç”µé‡æ¨¡å—å·²æ ¡å‡†ã€‚</div>
        <div class="chat-bubble ai">çµåŠ¨å²›åŠŸèƒ½å·²å°±ç»ªï¼Œç‚¹å‡»è¯•è¯•çœ‹ï¼</div>
        <div class="chat-bubble ai" style="color: #007aff; font-weight: bold;">**é‡è¦æç¤ºï¼š** è¦è·å¾—åƒAppä¸€æ ·æ— ç½‘å€æ çš„å…¨å±ä½“éªŒï¼Œè¯·é€šè¿‡æµè§ˆå™¨å°†æ­¤ç½‘é¡µ **â€œæ·»åŠ åˆ°ä¸»å±å¹•â€** åï¼Œå†ä»ä¸»å±å¹•å¯åŠ¨ï¼</div>
      </div>
      <div class="input-area">
        <input type="text" id="msg-input" placeholder="å‘æ¶ˆæ¯..." onkeydown="if(event.key === 'Enter') sendMsg()">
        <button onclick="sendMsg()" style="border:none; background:none; color:#007aff; font-weight:bold; font-size:16px;">â†‘</button>
      </div>
    </div>

    <!-- 4. App: ä¸–ç•Œä¹¦ -->
    <div id="app-lore" class="page">
      <div class="app-header">ä¸–ç•Œä¹¦ <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span></div>
      <div class="app-content">
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">è§’è‰²ï¼šçµçŠ€</strong><br>
          <span style="color:#666; font-size:14px">ä½ çš„å…¨èƒ½ AI åŠ©ç†ï¼Œå½“å‰è¿è¡Œåœ¨ WebOS 2.0 ç‰ˆæœ¬ã€‚</span>
        </div>
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">ä¸–ç•Œè§‚ï¼šèµ›åšæœ‹å…‹ 2077</strong><br>
          <span style="color:#666; font-size:14px">ä¸€ä¸ªç”±å·¨å‹ä¼ä¸šç»Ÿæ²»ï¼ŒæŠ€æœ¯é«˜åº¦å‘è¾¾ä½†ç¤¾ä¼šè´«å¯Œå·®è·å·¨å¤§çš„åä¹Œæ‰˜é‚¦æœªæ¥ä¸–ç•Œã€‚</span>
        </div>
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">æŠ€æœ¯ï¼šçµé­‚èŠ¯ç‰‡ (Soul Chip)</strong><br>
          <span style="color:#666; font-size:14px">èƒ½å¤Ÿå­˜å‚¨äººç±»æ„è¯†å’Œè®°å¿†çš„ç”Ÿç‰©æŠ€æœ¯èŠ¯ç‰‡ï¼Œæ˜¯æ°¸ç”Ÿçš„å¸Œæœ›ï¼Œä¹Ÿæ˜¯æƒåŠ›æ–—äº‰çš„ç„¦ç‚¹ã€‚</span>
        </div>
      </div>
    </div>

    <!-- 5. App: è®¾ç½® -->
    <div id="app-settings" class="page">
      <div class="app-header">è®¾ç½® <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span></div>
      <div class="app-content" style="background:#fff">
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>é£è¡Œæ¨¡å¼</span> 
          <div class="toggle-switch" id="airplane-mode-toggle" onclick="toggleSetting('airplane-mode-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>Wi-Fi</span> 
          <div class="toggle-switch on" id="wifi-toggle" onclick="toggleSetting('wifi-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px; border-bottom:1px solid #eee;">Wi-Fi ç½‘ç»œ <span style="float:right;color:#888">AI_Link_5G ></span></div>
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>è“ç‰™</span> 
          <div class="toggle-switch on" id="bluetooth-toggle" onclick="toggleSetting('bluetooth-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px; border-bottom:1px solid #eee;">é€šç”¨ <span style="float:right;color:#888">></span></div>
        <div style="padding:15px; border-bottom:1px solid #eee;">å£çº¸ <span style="float:right;color:#888">></span></div>
      </div>
    </div>

    <div class="home-bar" onclick="goHome()"></div>
  </div>
</div>

<script>
  // --- 1. æ—¶é—´åŒæ­¥é€»è¾‘ (Real Time) ---
  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const timeStr = `${h}:${m}`;
    
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    const week = weekDays[now.getDay()];
    const dateStr = `${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${week}`;

    document.getElementById('clock-small').innerText = timeStr;
    document.getElementById('clock-large').innerText = timeStr;
    document.getElementById('date-text').innerText = dateStr;
  }
  setInterval(updateClock, 1000);
  updateClock();

  // --- 2. çœŸå®ç”µæ± é€»è¾‘ (Battery API) ---
  function initBattery() {
    const battLevelEl = document.getElementById('batt-level');
    const battTextEl = document.getElementById('batt-text');
    const battBoxEl = document.getElementById('battery-box');
    
    if (navigator.getBattery) {
      navigator.getBattery().then(battery => {
        updateBatteryUI(battery);
        battery.addEventListener('levelchange', () => updateBatteryUI(battery));
        battery.addEventListener('chargingchange', () => updateBatteryUI(battery));
      });
    } else {
      const simulatedLevel = Math.floor(Math.random() * 30) + 70;
      battLevelEl.style.width = `${simulatedLevel}%`;
      battTextEl.innerText = `${simulatedLevel}%`;
      if (Math.random() > 0.7) {
          battBoxEl.classList.add('charging');
      }
    }

    function updateBatteryUI(battery) {
      const level = Math.floor(battery.level * 100);
      battLevelEl.style.width = `${level}%`;
      battTextEl.innerText = `${level}%`;
      
      if(level <= 20 && !battery.charging) battLevelEl.style.background = '#ff3b30';
      else battLevelEl.style.background = 'white';
      
      if(battery.charging) {
        battBoxEl.classList.add('charging');
      } else {
        battBoxEl.classList.remove('charging');
      }
    }
  }
  initBattery();

  // --- 3. äº¤äº’é€»è¾‘ ---
  let currentApp = 'lock-screen';

  function unlock() {
    const lock = document.getElementById('lock-screen');
    lock.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
    lock.style.transform = 'translateY(-100%)';
    setTimeout(() => {
      lock.classList.remove('active');
      lock.style.transform = '';
      document.getElementById('home-screen').classList.add('active');
      currentApp = 'home-screen';
    }, 400);
  }

  function openApp(id) {
    const activePage = document.querySelector('.page.active');
    if (activePage) {
      activePage.classList.remove('active');
    }
    document.getElementById(id).classList.add('active');
    currentApp = id;
  }

  function goHome() {
    const activePage = document.querySelector('.page.active');
    if (activePage && activePage.id !== 'home-screen' && activePage.id !== 'lock-screen') {
      activePage.style.transition = 'transform 0.3s cubic-bezier(0.55, 0.085, 0.68, 0.53), opacity 0.3s ease-out';
      activePage.style.transform = 'scale(0.9)';
      activePage.style.opacity = '0';
      setTimeout(() => {
        activePage.classList.remove('active');
        activePage.style = '';
      }, 300);
    }
    document.getElementById('home-screen').classList.add('active');
    currentApp = 'home-screen';
  }

  const aiResponses = [
    "å¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï¼", "æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ", "è¯·å‘Šè¯‰æˆ‘æ›´å¤šç»†èŠ‚ã€‚", "æˆ‘æ­£åœ¨å­¦ä¹ ä¸­ï¼Œè¯·ç¨ç­‰ã€‚",
    "è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼", "å¥½çš„ï¼Œæˆ‘æ˜ç™½äº†ã€‚", "æˆ‘ä»¬ç»§ç»­èŠèŠå§ã€‚", "å¾ˆé«˜å…´èƒ½å’Œä½ äº¤æµï¼",
    "è¯·é—®ä½ æœ‰ä»€ä¹ˆæ–°çš„æƒ³æ³•å—ï¼Ÿ", "æ€è€ƒä¸­...", "æˆ‘éœ€è¦æ›´å¤šä¿¡æ¯æ‰èƒ½å›ç­”ã€‚", "ä½ æœ€è¿‘è¿‡å¾—å¥½å—ï¼Ÿ"
  ];

  function sendMsg() {
    const input = document.getElementById('msg-input');
    const val = input.value.trim();
    if(!val) return;
    const chatBox = document.getElementById('chat-box');
    
    chatBox.innerHTML += `<div class="chat-bubble me">${val}</div>`;
    input.value = '';
    chatBox.scrollTop = chatBox.scrollHeight;

    setTimeout(() => {
      const randomResponse = aiResponses[Math.floor(Math.random() * aiResponses.length)];
      chatBox.innerHTML += `<div class="chat-bubble ai">${randomResponse}</div>`;
      chatBox.scrollTop = chatBox.scrollHeight;
    }, 800 + Math.random() * 500);
  }

  function toggleSetting(id) {
    const toggle = document.getElementById(id);
    toggle.classList.toggle('on');
    console.log(`${id} is now ${toggle.classList.contains('on') ? 'on' : 'off'}`);
  }

  // çµåŠ¨å²›éŸ³ä¹æ’­æ”¾é€»è¾‘
  let isPlaying = false;
  let dynamicIslandExpanded = false;
  const dynamicIslandEl = document.getElementById('dynamic-island-display');
  const songTitleEl = document.getElementById('song-title');
  const songArtistEl = document.getElementById('song-artist');
  const albumArtEl = document.getElementById('album-art');
  const playPauseBtnEl = document.getElementById('play-pause-btn');
  const dynamicIslandTextContentEl = dynamicIslandEl.querySelector('.text-content');
  const dynamicIslandControlsEl = dynamicIslandEl.querySelector('.controls');

  function updateDynamicIsland(playing, title = "æœªæ’­æ”¾", artist = "æœªçŸ¥", albumArt = "https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ") {
    isPlaying = playing;
    if (isPlaying) {
      albumArtEl.src = albumArt;
      songTitleEl.innerText = title;
      songArtistEl.innerText = artist;
      playPauseBtnEl.innerText = 'â¸'; 
      
      albumArtEl.style.display = 'block';
      dynamicIslandTextContentEl.style.display = 'flex';
      dynamicIslandControlsEl.style.display = 'flex';

      dynamicIslandEl.classList.add('expanded');
      dynamicIslandExpanded = true;
    } else {
      albumArtEl.style.display = 'none';
      dynamicIslandTextContentEl.style.display = 'none';
      dynamicIslandControlsEl.style.display = 'none';

      dynamicIslandEl.classList.remove('expanded');
      dynamicIslandExpanded = false;
    }
  }

  function togglePlayPause() {
    isPlaying = !isPlaying;
    playPauseBtnEl.innerText = isPlaying ? 'â¸' : 'â¯';
    console.log(`Music is now ${isPlaying ? 'playing' : 'paused'}`);
    
    if (!isPlaying && dynamicIslandExpanded) {
        setTimeout(() => {
            if (!isPlaying) {
                dynamicIslandEl.classList.remove('expanded');
                dynamicIslandExpanded = false;
            }
        }, 3000);
    }
  }

  function toggleDynamicIsland() {
    if (isPlaying) {
      dynamicIslandExpanded = !dynamicIslandExpanded;
      if (dynamicIslandExpanded) {
        dynamicIslandEl.classList.add('expanded');
      } else {
        dynamicIslandEl.classList.remove('expanded');
      }
    } else {
      console.log("çµåŠ¨å²›è¢«ç‚¹å‡»ï¼Œä½†æ²¡æœ‰éŸ³ä¹åœ¨æ’­æ”¾ã€‚");
    }
  }

  setTimeout(() => {
    updateDynamicIsland(true, "AIä¹‹æ­Œ", "çµçŠ€", "https://i.scdn.co/image/ab67616d0000b273d4029191d90fcc1a896d84a7");
  }, 3000);
</script>
</body>
</html>
