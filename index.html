<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<!-- 1. å¼€å¯â€œçœŸÂ·å…¨å±â€æ¨¡å¼çš„å…³é”®ä»£ç  -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">

<link rel="manifest" href="./manifest.json"> 
<link rel="apple-touch-icon" href="./icon-192.png"> 

<title>AI OS</title>
<style>
  /* --- åŸºç¡€é‡ç½® --- */
  * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; margin: 0; }
  body {
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100dvh;
    font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    overflow: hidden;
  }

  /* --- æ‰‹æœºå®¹å™¨ --- */
  .phone-frame {
    width: 100%; height: 100%; max-width: 420px;
    background: #000; position: relative; overflow: hidden;
  }

  /* --- å±å¹•å£çº¸ --- */
  .screen {
    width: 100%; height: 100%;
    background: url('https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?q=80&w=1000&auto=format&fit=crop') center/cover;
    position: relative; display: flex; flex-direction: column;
    transition: filter 0.3s;
  }

  /* --- é¡¶éƒ¨çŠ¶æ€æ  --- */
  .status-bar {
    position: absolute; top: 0; left: 0; right: 0;
    height: 48px; display: flex; justify-content: space-between; align-items: flex-end;
    padding: calc(10px + env(safe-area-inset-top)) 24px 10px;
    color: white; font-size: 15px; font-weight: 600; z-index: 100;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  .carrier-name { font-size: 14px; font-weight: 500; }
  
  .battery-container { display: flex; align-items: center; gap: 6px; }
  .battery-icon {
    width: 26px; height: 12px; border: 2px solid rgba(255,255,255,0.8); border-radius: 3px;
    position: relative; padding: 1px;
  }
  .battery-icon::after {
    content: ''; position: absolute; right: -4px; top: 2px;
    width: 2px; height: 4px; background: rgba(255,255,255,0.8); border-radius: 0 2px 2px 0;
  }
  .battery-level { height: 100%; background: white; border-radius: 1px; width: 60%; transition: width 0.5s; }
  .charging-bolt { display: none; font-size: 10px; }
  .charging .charging-bolt { display: block; }
  .charging .battery-level { background: #34c759; }

  /* --- çµåŠ¨å²› --- */
  .dynamic-island {
    position: absolute; top: calc(11px + env(safe-area-inset-top)); left: 50%; transform: translateX(-50%);
    width: 110px; height: 32px; background: #000; border-radius: 20px; z-index: 101;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex; justify-content: center; align-items: center;
    color: white; font-size: 14px; overflow: hidden;
  }
  .dynamic-island.expanded {
    width: 90%; max-width: 360px; height: 56px; border-radius: 30px;
    justify-content: flex-start; padding: 0 15px; gap: 10px;
  }
  .dynamic-island img.album-art { width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0; display: none; }
  .dynamic-island.expanded img.album-art { display: block; }
  .dynamic-island .text-content {
    flex-grow: 1; display: none; flex-direction: column; text-align: left;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .dynamic-island.expanded .text-content { display: flex; }
  .dynamic-island .title { font-weight: 600; font-size: 15px; }
  .dynamic-island .artist { font-size: 12px; opacity: 0.7; }
  .dynamic-island .controls { display: none; gap: 15px; font-size: 20px; }
  .dynamic-island.expanded .controls { display: flex; }

  /* --- é¡µé¢åˆ‡æ¢é€»è¾‘ --- */
  .page {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #fff; display: none; flex-direction: column;
    transform-origin: center bottom;
    padding-top: calc(48px + env(safe-area-inset-top));
    padding-bottom: calc(5px + 8px + env(safe-area-inset-bottom));
    z-index: 40;
  }
  /* å­é¡µé¢ï¼ˆåº”ç”¨å†…é¡µé¢ï¼‰å±‚çº§æ›´é«˜ */
  .subpage {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #fff; display: none; flex-direction: column;
    transform-origin: center bottom;
    padding-top: calc(48px + env(safe-area-inset-top));
    padding-bottom: calc(5px + 8px + env(safe-area-inset-bottom));
    z-index: 60;
  }
  #lock-screen {
    background: transparent; align-items: center; color: white;
    padding-top: calc(120px + env(safe-area-inset-top));
    padding-bottom: calc(50px + env(safe-area-inset-bottom));
    z-index: 50; text-align: center;
  }
  #home-screen { 
    background: transparent; 
    padding-top: calc(70px + env(safe-area-inset-top)); 
    padding-bottom: calc(20px + env(safe-area-inset-bottom)); 
    z-index: 40; 
  }

  .page.active, .subpage.active { display: flex; animation: appOpen 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
  @keyframes appOpen { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

  /* --- 1. é”å± --- */
  .clock-large { font-size: 86px; font-weight: 200; letter-spacing: -2px; line-height: 1; }
  .date-text { font-size: 20px; margin-top: 10px; font-weight: 500; opacity: 0.9; }
  .unlock-hint { margin-top: auto; opacity: 0.6; font-size: 14px; animation: pulse 2s infinite; }
  @keyframes pulse { 0% {opacity:0.3} 50% {opacity:0.8} 100% {opacity:0.3} }

  /* --- 2. æ¡Œé¢ --- */
  .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; row-gap: 30px; }
  .app-item { display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.1s;}
  .app-item:active { opacity: 0.6; transform: scale(0.95); }
  
  .app-icon { 
    width: 60px; height: 60px; border-radius: 16px; 
    display: flex; justify-content: center; align-items: center; 
    font-size: 28px; color: white; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
  }
  .app-icon.camera { background: linear-gradient(135deg, #ff5722, #ff9800); }
  .app-icon.phone { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
  .app-icon.browser { background: linear-gradient(135deg, #2196F3, #03A9F4); }
  .app-icon.music { background: linear-gradient(135deg, #9C27B0, #E040FB); }
  .app-icon.mail { background: linear-gradient(135deg, #F44336, #FF7043); }

  .app-name { color: white; font-size: 12px; font-weight: 500; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
  
  .dock {
    margin-top: auto; background: rgba(255,255,255,0.25); backdrop-filter: blur(20px);
    border-radius: 32px; padding: 18px; display: flex; justify-content: space-around; 
    margin-bottom: env(safe-area-inset-bottom);
    width: 100%; box-sizing: border-box;
  }
  .dock .app-item { margin: 0; flex-basis: 25%; }
  .dock .app-item .app-icon { width: 50px; height: 50px; font-size: 24px; }
  .dock .app-item .app-name { margin-top: 5px; }

  /* --- é€šç”¨åº”ç”¨å¤´éƒ¨ --- */
  .app-header { 
    position: absolute; top: 0; left: 0; right: 0; 
    height: 96px; 
    padding: calc(50px + env(safe-area-inset-top)) 20px 10px; 
    background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.1); 
    font-weight: 700; font-size: 22px; 
    display: flex; align-items: center; justify-content: space-between;
    z-index: 10;
  }
  /* é€€å‡ºæŒ‰é’®é€šç”¨æ ·å¼ */
  .exit-btn {
    font-size:14px; color:#007aff; font-weight:400;
    padding: 4px 8px;
    border-radius: 6px;
    transition: background 0.2s;
  }
  .exit-btn:active {
    background: rgba(0,122,255,0.1);
  }
  .app-content { flex: 1; overflow-y: auto; padding: 20px; background: #f2f2f7; }

  /* --- èŠå¤© App ä¸“å±æ ·å¼ (æ ¸å¿ƒå¸ƒå±€ä¼˜åŒ–) --- */
  #app-chat {
    display: flex;
    flex-direction: column;
    padding-top: 0; 
    padding-bottom: 0;
  }
  .chat-main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  /* èŠå¤©æ¶ˆæ¯å®¹å™¨ - æ ¸å¿ƒå¸ƒå±€ä¿®å¤ */
  .chat-tab-content {
    flex: 1;
    overflow-y: auto;
    background: #f2f2f7;
    display: none;
    flex-direction: column;
    /* å…³é”®ï¼šä¸Šä¸‹å†…è¾¹è·ï¼Œé¿å¼€è¾“å…¥æ¡†å’Œå¤´éƒ¨ï¼Œè§£å†³æ˜¾ç¤ºä¸å…¨ */
    padding: 20px;
    padding-bottom: 80px !important;
  }
  .chat-tab-content.active {
    display: flex;
  }
  /* èŠå¤©æ¶ˆæ¯ç›’å­ - æ ¸å¿ƒä¼˜åŒ– */
  #chat-box {
    display:flex; flex-direction:column;
    gap: 12px; /* æ¶ˆæ¯ä¹‹é—´çš„é—´è·ï¼Œæ›´ç¾è§‚ */
    width: 100%;
  }
  /* èŠå¤©æ°”æ³¡ - ä¼˜åŒ– */
  .chat-bubble { 
    padding: 14px 20px; 
    border-radius: 20px; 
    max-width: 85%; 
    font-size: 16px; 
    line-height: 1.5; 
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    word-wrap: break-word; /* è‡ªåŠ¨æ¢è¡Œï¼Œè§£å†³é•¿æ–‡æœ¬æº¢å‡º */
    word-break: break-all; /* å¼ºåˆ¶æ¢è¡Œï¼Œå…¼å®¹è‹±æ–‡é•¿å•è¯ */
  }
  .chat-bubble.ai { background: #fff; align-self: flex-start; border-bottom-left-radius: 4px; }
  .chat-bubble.me { background: #007aff; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
  
  /* èŠå¤©åº•éƒ¨è¾“å…¥æ¡† - æ ¸å¿ƒä¼˜åŒ–ï¼šå›ºå®šå®šä½ï¼Œä¸æŒ¤å‹æ¶ˆæ¯ */
  .chat-input-area { 
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 20;
    padding: 12px 15px calc(12px + env(safe-area-inset-bottom)) 15px; 
    background: #fff; 
    display: flex; 
    gap:10px; 
    border-top: 1px solid #eee; 
  }
  .chat-input-area input { 
    flex: 1; 
    height: 44px; 
    padding: 0 18px; 
    border: 1px solid #e0e0e0; 
    border-radius: 22px; 
    font-size: 16px; 
    outline: none; 
    background: #f5f5f5;
    /* ç¦æ­¢è¾“å…¥æ¡†ç¼©æ”¾ */
    resize: none;
  }
  .chat-input-area input:focus { 
    background: #fff; 
    border-color: #007aff; 
  }
  .send-btn {
    border:none; 
    background:none; 
    color:#007aff; 
    font-weight:bold; 
    font-size:18px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }
  .send-btn:active {
    background: rgba(0,122,255,0.1);
  }

  /* èŠå¤© App åº•éƒ¨å¯¼èˆªæ  - å›ºå®šå®šä½ */
  .chat-tab-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: #f8f8f8;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding-bottom: env(safe-area-inset-bottom);
    z-index: 15;
  }
  .chat-tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 10px;
    color: #8e8e93;
    transition: color 0.2s;
  }
  .chat-tab-item.active {
    color: #007aff;
  }
  .chat-tab-item .icon {
    font-size: 22px;
    margin-bottom: 2px;
  }

  /* --- æ‰€æœ‰åº”ç”¨çš„è®¾ç½®é¡µé¢ (ç‹¬ç«‹å­é¡µé¢) --- */
  .app-settings-page {
    background: #f2f2f7;
  }
  /* è®¾ç½®é¡µé¢å¼€å…³æ ·å¼ */
  .toggle-switch {
    width: 50px; height: 30px; background: #e9e9ea; border-radius: 15px; position: relative;
    transition: background-color 0.3s;
  }
  .toggle-switch.on { background-color: #34c759; }
  .toggle-switch .slider {
    width: 26px; height: 26px; background: white; border-radius: 50%; position: absolute;
    top: 2px; left: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: left 0.3s;
  }
  .toggle-switch.on .slider { left: 22px; }
  .settings-section {
    background: white;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    overflow: hidden;
  }
  .settings-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
    color: #333;
  }
  .settings-item:last-child {
    border-bottom: none;
  }
  .settings-item span:first-child {
    flex-grow: 1;
  }
  .settings-item input[type="text"], .settings-item input[type="password"], .settings-item select {
    flex-shrink: 0;
    width: 60%;
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
  }
  .settings-item select {
    appearance: none;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M5%207l5%205%205-5z%22%20fill%3D%22%23888%22%2F%3E%3C%2Fsvg%3E');
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 30px;
  }
  .settings-item-label {
    width: 30%;
    flex-shrink: 0;
    margin-right: 10px;
  }
  .settings-button {
    background: #007aff;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-size: 17px;
    font-weight: 600;
    width: 100%;
    text-align: center;
    cursor: pointer;
    transition: background 0.2s;
  }
  .settings-button:active {
    background: #005bb5;
  }

  /* åº•éƒ¨é»‘æ¡ */
  .home-bar {
    position: absolute; left: 50%; transform: translateX(-50%);
    width: 130px; height: 5px; background: #fff; border-radius: 3px; z-index: 999; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    bottom: calc(8px + env(safe-area-inset-bottom)); 
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar">
      <span class="carrier-name">AI_Link</span>
      <span id="clock-small">--:--</span>
      <div class="battery-container" id="battery-box">
        <span class="charging-bolt">âš¡</span>
        <span id="batt-text" style="font-size:12px; margin-right:4px;"></span>
        <div class="battery-icon">
          <div class="battery-level" id="batt-level"></div>
        </div>
      </div>
    </div>
    
    <!-- çµåŠ¨å²› -->
    <div class="dynamic-island" id="dynamic-island-display" onclick="toggleDynamicIsland()">
      <img src="https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ" alt="Album Art" class="album-art" id="album-art">
      <div class="text-content">
        <div class="title" id="song-title">æ­Œæ›²åç§°</div>
        <div class="artist" id="song-artist">è‰ºæœ¯å®¶</div>
      </div>
      <div class="controls">
        <span onclick="event.stopPropagation(); console.log('Previous Track')">â®</span>
        <span onclick="event.stopPropagation(); togglePlayPause()" id="play-pause-btn">â¯</span>
        <span onclick="event.stopPropagation(); console.log('Next Track')">â­</span>
      </div>
    </div>

    <!-- 1. é”å± -->
    <div id="lock-screen" class="page active" onclick="unlock()">
      <div>
        <div class="clock-large" id="clock-large">12:00</div>
        <div class="date-text" id="date-text">10æœˆ24æ—¥ æ˜ŸæœŸäºŒ</div>
      </div>
      <div class="unlock-hint">å‘ä¸Šæ»‘åŠ¨è§£é”</div>
    </div>

    <!-- 2. æ¡Œé¢ -->
    <div id="home-screen" class="page">
      <div class="app-grid">
        <div class="app-item" onclick="openApp('app-chat')">
          <div class="app-icon" style="background: linear-gradient(135deg, #30cfd0, #330867);">ğŸ’¬</div>
          <span class="app-name">èŠå¤©</span>
        </div>
        <div class="app-item" onclick="openApp('app-lore')">
          <div class="app-icon" style="background: linear-gradient(135deg, #d299c2, #fef9d7);">ğŸ“–</div>
          <span class="app-name">ä¸–ç•Œä¹¦</span>
        </div>
        <div class="app-item" onclick="openApp('app-system-settings')">
          <div class="app-icon" style="background: linear-gradient(135deg, #a1c4fd, #c2e9fb);">âš™ï¸</div>
          <span class="app-name">è®¾ç½®</span>
        </div>
        <div class="app-item" onclick="openApp('app-camera')">
          <div class="app-icon camera">ğŸ“·</div>
          <span class="app-name">ç›¸æœº</span>
        </div>
        <div class="app-item" onclick="openApp('app-phone')">
          <div class="app-icon phone">ğŸ“</div>
          <span class="app-name">ç”µè¯</span>
        </div>
        <div class="app-item" onclick="openApp('app-browser')">
          <div class="app-icon browser">ğŸŒ</div>
          <span class="app-name">æµè§ˆå™¨</span>
        </div>
        <div class="app-item" onclick="openApp('app-music')">
          <div class="app-icon music">ğŸµ</div>
          <span class="app-name">éŸ³ä¹</span>
        </div>
        <div class="app-item" onclick="openApp('app-mail')">
          <div class="app-icon mail">âœ‰ï¸</div>
          <span class="app-name">é‚®ä»¶</span>
        </div>
      </div>

      <div class="dock">
        <div class="app-item" onclick="openApp('app-phone')"><div class="app-icon phone">ğŸ“</div><span class="app-name">ç”µè¯</span></div>
        <div class="app-item" onclick="openApp('app-browser')"><div class="app-icon browser">ğŸŒ</div><span class="app-name">æµè§ˆå™¨</span></div>
        <div class="app-item" onclick="openApp('app-music')"><div class="app-icon music">ğŸµ</div><span class="app-name">éŸ³ä¹</span></div>
        <div class="app-item" onclick="openApp('app-mail')"><div class="app-icon mail">âœ‰ï¸</div><span class="app-name">é‚®ä»¶</span></div>
      </div>
    </div>

    <!-- 3. App: èŠå¤© (ä¸»é¡µé¢) -->
    <div id="app-chat" class="page">
      <div class="app-header">
        èŠå¤©
        <span class="exit-btn" onclick="closeApp('app-chat')">é€€å‡º</span>
      </div>
      <div class="chat-main-content">
        <!-- æ¶ˆæ¯ Tab (é»˜è®¤æ˜¾ç¤º) -->
        <div id="chat-tab-messages" class="chat-tab-content active">
          <div id="chat-box"></div>
          <!-- èŠå¤©è¾“å…¥æ¡† - ç‹¬ç«‹æå–ï¼Œå›ºå®šåº•éƒ¨ -->
          <div class="chat-input-area">
            <input type="text" id="msg-input" placeholder="å‘æ¶ˆæ¯..." onkeydown="if(event.key === 'Enter') sendMsg()">
            <button class="send-btn" onclick="sendMsg()">â†‘</button>
          </div>
        </div>

        <!-- è”ç³»äºº Tab -->
        <div id="chat-tab-contacts" class="chat-tab-content">
          <div class="settings-section">
            <div class="settings-item" style="justify-content: center; font-size:18px; font-weight:500;">å¸¸ç”¨è”ç³»äºº</div>
            <div class="settings-item" onclick="openChat('çµçŠ€')">AI åŠ©æ‰‹ Â· çµçŠ€</div>
            <div class="settings-item" onclick="openChat('å°çˆ±')">AI åŠ©æ‰‹ Â· å°çˆ±</div>
            <div class="settings-item" onclick="openChat('å°åº¦')">AI åŠ©æ‰‹ Â· å°åº¦</div>
          </div>
        </div>

        <!-- åŠ¨æ€ Tab -->
        <div id="chat-tab-moments" class="chat-tab-content">
          <div class="settings-section" style="text-align: center; padding: 40px 20px; color: #888;">
            <div style="font-size:48px; margin-bottom:20px;">âœ¨</div>
            æš‚æ— åŠ¨æ€ï¼Œå¿«å»åˆ†äº«ä½ çš„ç”Ÿæ´»å§ï¼
          </div>
        </div>

        <!-- æˆ‘çš„ Tab -->
        <div id="chat-tab-me" class="chat-tab-content">
          <div class="settings-section">
            <div class="settings-item">
              <span>æˆ‘çš„æ˜µç§°</span>
              <span style="color:#888">AI ç”¨æˆ·</span>
            </div>
            <div class="settings-item">
              <span>æˆ‘çš„è´¦å·</span>
              <span style="color:#888">12345678</span>
            </div>
            <div class="settings-item" onclick="openSubpage('app-chat-settings')">
              <span>èŠå¤©è®¾ç½®</span>
              <span style="color:#007aff">â–¶</span>
            </div>
          </div>
          <div class="settings-section">
            <button class="settings-button" onclick="clearChatHistory()">æ¸…ç©ºèŠå¤©è®°å½•</button>
          </div>
        </div>
      </div>

      <!-- èŠå¤© App åº•éƒ¨å¯¼èˆªæ  -->
      <div class="chat-tab-bar" id="chat-tab-bar">
        <div class="chat-tab-item active" data-tab="messages" onclick="switchChatTab('messages')">
          <span class="icon">ğŸ’¬</span> <span>æ¶ˆæ¯</span>
        </div>
        <div class="chat-tab-item" data-tab="contacts" onclick="switchChatTab('contacts')">
          <span class="icon">ğŸ‘¥</span> <span>è”ç³»äºº</span>
        </div>
        <div class="chat-tab-item" data-tab="moments" onclick="switchChatTab('moments')">
          <span class="icon">âœ¨</span> <span>åŠ¨æ€</span>
        </div>
        <div class="chat-tab-item" data-tab="me" onclick="switchChatTab('me')">
          <span class="icon">ğŸ‘¤</span> <span>æˆ‘</span>
        </div>
      </div>
    </div>

    <!-- 3-1. èŠå¤© App å†…ç½®è®¾ç½® (ç‹¬ç«‹å­é¡µé¢) -->
    <div id="app-chat-settings" class="subpage app-settings-page">
      <div class="app-header">
        èŠå¤©è®¾ç½®
        <span class="exit-btn" onclick="closeSubpage('app-chat-settings')">è¿”å›</span>
      </div>
      <div class="app-content">
        <div class="settings-section">
          <div class="settings-item">
            <span class="settings-item-label">API åœ°å€</span>
            <input type="text" id="api-url-input" placeholder="http://localhost:8000/chat">
          </div>
          <div class="settings-item">
            <span class="settings-item-label">API å¯†é’¥</span>
            <input type="password" id="api-key-input" placeholder="ä½ çš„ API å¯†é’¥">
          </div>
          <div class="settings-item">
            <span class="settings-item-label">AI æ¨¡å‹</span>
            <select id="ai-model-select"></select>
          </div>
          <div class="settings-item">
            <button class="settings-button" onclick="saveChatSettings()">ä¿å­˜è®¾ç½®</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 4. App: ä¸–ç•Œä¹¦ -->
    <div id="app-lore" class="page">
      <div class="app-header">
        ä¸–ç•Œä¹¦
        <span class="exit-btn" onclick="closeApp('app-lore')">é€€å‡º</span>
      </div>
      <div class="app-content">
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333; font-size:18px">è§’è‰²ï¼šçµçŠ€</strong><br>
          <span style="color:#666; font-size:15px; line-height:1.6">ä½ çš„å…¨èƒ½ AI åŠ©ç†ï¼Œå½“å‰è¿è¡Œåœ¨ WebOS 2.0 ç‰ˆæœ¬ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€äº¤äº’ã€API å¯¹æ¥ã€ç³»ç»ŸçŠ¶æ€ç›‘æ§ç­‰åŠŸèƒ½ã€‚</span>
        </div>
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333; font-size:18px">ä¸–ç•Œè§‚ï¼šèµ›åšæœ‹å…‹ 2077</strong><br>
          <span style="color:#666; font-size:15px; line-height:1.6">ä¸€ä¸ªç”±å·¨å‹ä¼ä¸šç»Ÿæ²»ï¼ŒæŠ€æœ¯é«˜åº¦å‘è¾¾ä½†ç¤¾ä¼šè´«å¯Œå·®è·å·¨å¤§çš„åä¹Œæ‰˜é‚¦æœªæ¥ä¸–ç•Œï¼Œä¹‰ä½“æ”¹é€ ã€ç½‘ç»œç©ºé—´ã€çµé­‚èŠ¯ç‰‡æˆä¸ºæ ¸å¿ƒå…ƒç´ ã€‚</span>
        </div>
        <div style="background:white; padding:15px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333; font-size:18px">æŠ€æœ¯ï¼šçµé­‚èŠ¯ç‰‡ (Soul Chip)</strong><br>
          <span style="color:#666; font-size:15px; line-height:1.6">èƒ½å¤Ÿå­˜å‚¨äººç±»æ„è¯†å’Œè®°å¿†çš„ç”Ÿç‰©æŠ€æœ¯èŠ¯ç‰‡ï¼Œæ˜¯æ°¸ç”Ÿçš„å¸Œæœ›ï¼Œä¹Ÿæ˜¯å„å¤§ä¼ä¸šå’ŒåŠ¿åŠ›äº‰å¤ºçš„æ ¸å¿ƒèµ„æºï¼Œæ­è½½è¯¥èŠ¯ç‰‡çš„è®¾å¤‡å¯å®ç°æ„è¯†äº’è”ã€‚</span>
        </div>
      </div>
    </div>

    <!-- 5. ç³»ç»Ÿè®¾ç½® App (ç‹¬ç«‹åº”ç”¨) -->
    <div id="app-system-settings" class="page">
      <div class="app-header">
        è®¾ç½®
        <span class="exit-btn" onclick="closeApp('app-system-settings')">é€€å‡º</span>
      </div>
      <div class="app-content" style="background:#fff; padding:0;">
        <div style="padding:15px 20px; border-bottom:1px solid #eee; font-size:20px; font-weight:600; color:#333">æ— çº¿å’Œç½‘ç»œ</div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>é£è¡Œæ¨¡å¼</span> 
          <div class="toggle-switch" id="airplane-mode-toggle" onclick="toggleSetting('airplane-mode-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>Wi-Fi</span> 
          <div class="toggle-switch on" id="wifi-toggle" onclick="toggleSetting('wifi-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee;">
          <span>å·²è¿æ¥</span>
          <span style="float:right;color:#007aff; font-size:14px">AI_Link_5G</span>
        </div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>è“ç‰™</span> 
          <div class="toggle-switch on" id="bluetooth-toggle" onclick="toggleSetting('bluetooth-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee; font-size:20px; font-weight:600; color:#333; margin-top:10px">è®¾å¤‡</div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee;">é€šç”¨ <span style="float:right;color:#888">â–¶</span></div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee;">å£çº¸ä¸ä¸ªæ€§åŒ– <span style="float:right;color:#888">â–¶</span></div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee;">ç”µæ±  <span style="float:right;color:#888">â–¶</span></div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee; font-size:20px; font-weight:600; color:#333; margin-top:10px">åº”ç”¨</div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee;">åº”ç”¨ç®¡ç† <span style="float:right;color:#888">â–¶</span></div>
        <div style="padding:15px 20px; border-bottom:1px solid #eee;">æƒé™ç®¡ç† <span style="float:right;color:#888">â–¶</span></div>
      </div>
    </div>

    <!-- 6. ç›¸æœº App (ç©ºå£³ï¼Œå¸¦é€€å‡ºé”®) -->
    <div id="app-camera" class="page">
      <div class="app-header">
        ç›¸æœº
        <span class="exit-btn" onclick="closeApp('app-camera')">é€€å‡º</span>
      </div>
      <div class="app-content" style="background:#000; display:flex; align-items:center; justify-content:center; padding:0;">
        <div style="text-align:center; color:#fff; opacity:0.8;">
          <div style="font-size:80px; margin-bottom:20px;">ğŸ“·</div>
          <div style="font-size:20px;">ç›¸æœºåŠŸèƒ½å¾…å¼€å‘</div>
        </div>
      </div>
    </div>

    <!-- 7. ç”µè¯ App (ç©ºå£³ï¼Œå¸¦é€€å‡ºé”®) -->
    <div id="app-phone" class="page">
      <div class="app-header">
        ç”µè¯
        <span class="exit-btn" onclick="closeApp('app-phone')">é€€å‡º</span>
      </div>
      <div class="app-content" style="background:#f2f2f7;">
        <div class="settings-section" style="text-align:center; padding:40px 20px;">
          <div style="font-size:60px; margin-bottom:20px; color:#007aff;">ğŸ“</div>
          <div style="font-size:18px; color:#333; margin-bottom:10px;">ç”µè¯åŠŸèƒ½å¾…å¼€å‘</div>
          <div style="font-size:14px; color:#888;">æš‚ä¸æ”¯æŒæ‹¨æ‰“ç”µè¯</div>
        </div>
      </div>
    </div>

    <!-- 8. æµè§ˆå™¨ App (ç©ºå£³ï¼Œå¸¦é€€å‡ºé”®) -->
    <div id="app-browser" class="page">
      <div class="app-header">
        æµè§ˆå™¨
        <span class="exit-btn" onclick="closeApp('app-browser')">é€€å‡º</span>
      </div>
      <div class="app-content" style="background:#fff; padding:0;">
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; gap:10px; align-items:center;">
          <input type="text" placeholder="è¾“å…¥ç½‘å€æˆ–æœç´¢å†…å®¹" style="flex:1; border:1px solid #eee; border-radius:8px; padding:8px 12px; font-size:16px; outline:none;">
          <span style="color:#007aff; font-weight:600;">æœç´¢</span>
        </div>
        <div style="height:100%; display:flex; align-items:center; justify-content:center; color:#888;">
          æµè§ˆå™¨å†…æ ¸å¾…åŠ è½½
        </div>
      </div>
    </div>

    <!-- 9. éŸ³ä¹ App (ç©ºå£³ï¼Œå¸¦é€€å‡ºé”®) -->
    <div id="app-music" class="page">
      <div class="app-header">
        éŸ³ä¹
        <span class="exit-btn" onclick="closeApp('app-music')">é€€å‡º</span>
      </div>
      <div class="app-content" style="background:#f2f2f7;">
        <div class="settings-section" style="text-align:center; padding:40px 20px;">
          <div style="font-size:60px; margin-bottom:20px; color:#9C27B0;">ğŸµ</div>
          <div style="font-size:18px; color:#333; margin-bottom:10px;">éŸ³ä¹åº“ä¸ºç©º</div>
          <div style="font-size:14px; color:#888;">å¯é€šè¿‡çµåŠ¨å²›æ§åˆ¶èƒŒæ™¯éŸ³ä¹</div>
        </div>
      </div>
    </div>

    <!-- 10. é‚®ä»¶ App (ç©ºå£³ï¼Œå¸¦é€€å‡ºé”®) -->
    <div id="app-mail" class="page">
      <div class="app-header">
        é‚®ä»¶
        <span class="exit-btn" onclick="closeApp('app-mail')">é€€å‡º</span>
      </div>
      <div class="app-content" style="background:#f2f2f7;">
        <div class="settings-section" style="text-align:center; padding:40px 20px;">
          <div style="font-size:60px; margin-bottom:20px; color:#F44336;">âœ‰ï¸</div>
          <div style="font-size:18px; color:#333; margin-bottom:10px;">é‚®ä»¶åŠŸèƒ½å¾…å¼€å‘</div>
          <div style="font-size:14px; color:#888;">æš‚ä¸æ”¯æŒæ”¶å‘é‚®ä»¶</div>
        </div>
      </div>
    </div>

    <div class="home-bar" onclick="backToHomeScreen()"></div>
  </div>
</div>

<script>
  // ====================================================================
  // 1. å…¨å±€ç³»ç»ŸåŠŸèƒ½ (æ—¶é—´ã€ç”µæ± ã€App/å­é¡µé¢åˆ‡æ¢ã€é€€å‡ºé”®)
  // ====================================================================

  // --- æ—¶é—´åŒæ­¥é€»è¾‘ (Real Time) ---
  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const timeStr = `${h}:${m}`;
    
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    const week = weekDays[now.getDay()];
    const dateStr = `${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${week}`;

    document.getElementById('clock-small').innerText = timeStr;
    document.getElementById('clock-large').innerText = timeStr;
    document.getElementById('date-text').innerText = dateStr;
  }
  setInterval(updateClock, 1000);
  updateClock();

  // --- çœŸå®ç”µæ± é€»è¾‘ (Battery API) ---
  function initBattery() {
    const battLevelEl = document.getElementById('batt-level');
    const battTextEl = document.getElementById('batt-text');
    const battBoxEl = document.getElementById('battery-box');
    
    if (navigator.getBattery) {
      navigator.getBattery().then(battery => {
        updateBatteryUI(battery);
        battery.addEventListener('levelchange', () => updateBatteryUI(battery));
        battery.addEventListener('chargingchange', () => updateBatteryUI(battery));
      });
    } else {
      const simulatedLevel = Math.floor(Math.random() * 30) + 70;
      battLevelEl.style.width = `${simulatedLevel}%`;
      battTextEl.innerText = `${simulatedLevel}%`;
      if (Math.random() > 0.7) {
          battBoxEl.classList.add('charging');
      }
    }

    function updateBatteryUI(battery) {
      const level = Math.floor(battery.level * 100);
      battLevelEl.style.width = `${level}%`;
      battTextEl.innerText = `${level}%`;
      
      if(level <= 20 && !battery.charging) battLevelEl.style.background = '#ff3b30';
      else battLevelEl.style.background = 'white';
      
      if(battery.charging) {
        battBoxEl.classList.add('charging');
      } else {
        battBoxEl.classList.remove('charging');
      }
    }
  }
  initBattery();

  // --- æ ¸å¿ƒï¼šApp/å­é¡µé¢åˆ‡æ¢ + ç»Ÿä¸€é€€å‡ºé€»è¾‘ (æ»¡è¶³æ‰€æœ‰é¡µé¢æœ‰é€€å‡ºé”®) ---
  // å…³é—­æ‰€æœ‰æ´»è·ƒé¡µé¢
  function closeAllActivePages() {
    document.querySelectorAll('.page.active, .subpage.active').forEach(page => {
      page.classList.remove('active');
    });
  }
  // æ‰“å¼€App (å…³é—­å…¶ä»–æ‰€æœ‰ï¼Œæ˜¾ç¤ºç›®æ ‡App)
  function openApp(appId) {
    closeAllActivePages();
    document.getElementById(appId).classList.add('active');
    // èŠå¤©Appåˆå§‹åŒ–
    if (appId === 'app-chat') {
        loadChatHistory();
        scrollChatToBottom();
        switchChatTab('messages');
    }
  }
  // å…³é—­App (è¿”å›æ¡Œé¢)
  function closeApp(appId) {
    document.getElementById(appId).classList.remove('active');
    document.getElementById('home-screen').classList.add('active');
  }
  // æ‰“å¼€å­é¡µé¢ (åº”ç”¨å†…é¡µé¢ï¼Œå¦‚èŠå¤©è®¾ç½®)
  function openSubpage(subpageId) {
    document.getElementById(subpageId).classList.add('active');
  }
  // å…³é—­å­é¡µé¢ (è¿”å›æ‰€å±Appä¸»é¡µé¢)
  function closeSubpage(subpageId) {
    document.getElementById(subpageId).classList.remove('active');
  }
  // è§£é”é€»è¾‘ (é”å±â†’æ¡Œé¢)
  function unlock() {
    const lock = document.getElementById('lock-screen');
    lock.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
    lock.style.transform = 'translateY(-100%)';
    setTimeout(() => {
      lock.classList.remove('active');
      lock.style.transform = '';
      document.getElementById('home-screen').classList.add('active');
    }, 400);
  }
  // åº•éƒ¨é»‘æ¡ï¼šè¿”å›æ¡Œé¢ (å…¨å±€é€šç”¨)
  function backToHomeScreen() {
    closeAllActivePages();
    document.getElementById('home-screen').classList.add('active');
  }

  // --- çµåŠ¨å²›éŸ³ä¹æ’­æ”¾é€»è¾‘ ---
  let isPlaying = false;
  let dynamicIslandExpanded = false;
  const dynamicIslandEl = document.getElementById('dynamic-island-display');
  const songTitleEl = document.getElementById('song-title');
  const songArtistEl = document.getElementById('song-artist');
  const albumArtEl = document.getElementById('album-art');
  const playPauseBtnEl = document.getElementById('play-pause-btn');

  function updateDynamicIsland(playing, title = "æœªæ’­æ”¾", artist = "æœªçŸ¥", albumArt = "https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ") {
    isPlaying = playing;
    if (isPlaying) {
      albumArtEl.src = albumArt;
      songTitleEl.innerText = title;
      songArtistEl.innerText = artist;
      playPauseBtnEl.innerText = 'â¸'; 
      dynamicIslandEl.classList.add('expanded');
      dynamicIslandExpanded = true;
    } else {
      dynamicIslandEl.classList.remove('expanded');
      dynamicIslandExpanded = false;
    }
  }

  function togglePlayPause() {
    isPlaying = !isPlaying;
    playPauseBtnEl.innerText = isPlaying ? 'â¸' : 'â¯';
    if (!isPlaying && dynamicIslandExpanded) {
        setTimeout(() => {
            if (!isPlaying) dynamicIslandEl.classList.remove('expanded');
        }, 3000);
    }
  }

  function toggleDynamicIsland() {
    if (isPlaying) {
      dynamicIslandExpanded = !dynamicIslandExpanded;
      dynamicIslandEl.classList.toggle('expanded', dynamicIslandExpanded);
    }
  }

  // 3ç§’åè‡ªåŠ¨æ’­æ”¾çµåŠ¨å²›éŸ³ä¹
  setTimeout(() => {
    updateDynamicIsland(true, "AIä¹‹æ­Œ", "çµçŠ€", "https://i.scdn.co/image/ab67616d0000b273d4029191d90fcc1a896d84a7");
  }, 3000);

  // --- ç³»ç»Ÿè®¾ç½®å¼€å…³é€»è¾‘ ---
  function toggleSetting(id) {
    const toggle = document.getElementById(id);
    toggle.classList.toggle('on');
  }

  // ====================================================================
  // 2. èŠå¤© App ä¸“å±åŠŸèƒ½ (å¸ƒå±€ä¼˜åŒ–+ç‹¬ç«‹è®¾ç½®)
  // ====================================================================

  // AI å›å¤æ¨¡æ‹Ÿåº“
  const aiResponses = [
    "å¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï¼", "æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ", "è¯·å‘Šè¯‰æˆ‘æ›´å¤šç»†èŠ‚ã€‚", "æˆ‘æ­£åœ¨å­¦ä¹ ä¸­ï¼Œè¯·ç¨ç­‰ã€‚",
    "è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼", "å¥½çš„ï¼Œæˆ‘æ˜ç™½äº†ã€‚", "æˆ‘ä»¬ç»§ç»­èŠèŠå§ã€‚", "å¾ˆé«˜å…´èƒ½å’Œä½ äº¤æµï¼",
    "è¯·é—®ä½ æœ‰ä»€ä¹ˆæ–°çš„æƒ³æ³•å—ï¼Ÿ", "æ€è€ƒä¸­...", "æˆ‘éœ€è¦æ›´å¤šä¿¡æ¯æ‰èƒ½å›ç­”ã€‚", "ä½ æœ€è¿‘è¿‡å¾—å¥½å—ï¼Ÿ",
    "è¿™æ¡æ¶ˆæ¯æ¥è‡ªæ¨¡æ‹Ÿ AIï¼Œè¯·åœ¨èŠå¤©è®¾ç½®ä¸­é…ç½® APIã€‚",
    "ä½ é…ç½®äº† API å—ï¼Ÿæˆ‘è¿˜æ²¡æ”¶åˆ°å‘¢ï¼"
  ];
  let chatHistory = []; // èŠå¤©è®°å½•
  const chatBox = document.getElementById('chat-box');
  // API é…ç½®æœ¬åœ°å­˜å‚¨
  let apiSettings = JSON.parse(localStorage.getItem('chatApiSettings')) || {
    url: '',
    key: '',
    model: ''
  };
  // æ¨¡æ‹ŸAIæ¨¡å‹åˆ—è¡¨
  const availableModels = [
    { id: 'gpt-3.5-turbo', name: 'GPT-3.5 Turbo' },
    { id: 'gpt-4o', name: 'GPT-4o' },
    { id: 'kimi-moonshot', name: 'Kimi Moonshot' },
    { id: 'gemini-pro', name: 'Gemini Pro' }
  ];

  // åŠ è½½èŠå¤©å†å²
  function loadChatHistory() {
    const storedHistory = localStorage.getItem('aiChatHistory');
    if (storedHistory) {
      chatHistory = JSON.parse(storedHistory);
      chatBox.innerHTML = '';
      chatHistory.forEach(msg => {
        chatBox.innerHTML += `<div class="chat-bubble ${msg.sender}">${msg.text}</div>`;
      });
    } else {
      // é¦–æ¬¡æ¬¢è¿è¯­
      chatBox.innerHTML = `<div class="chat-bubble ai">ä½ å¥½ï¼ç³»ç»Ÿæ—¶é—´å·²åŒæ­¥ã€‚</div>
                           <div class="chat-bubble ai">ç”µé‡æ¨¡å—å·²æ ¡å‡†ã€‚</div>
                           <div class="chat-bubble ai">çµåŠ¨å²›åŠŸèƒ½å·²å°±ç»ªï¼Œç‚¹å‡»è¯•è¯•çœ‹ï¼</div>`;
      chatHistory = [
        { sender: 'ai', text: 'ä½ å¥½ï¼ç³»ç»Ÿæ—¶é—´å·²åŒæ­¥ã€‚' },
        { sender: 'ai', text: 'ç”µé‡æ¨¡å—å·²æ ¡å‡†ã€‚' },
        { sender: 'ai', text: 'çµåŠ¨å²›åŠŸèƒ½å·²å°±ç»ªï¼Œç‚¹å‡»è¯•è¯•çœ‹ï¼' }
      ];
      localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
    }
  }

  // æ»šåŠ¨èŠå¤©åˆ°åº•éƒ¨ (ä¼˜åŒ–ï¼šå…¼å®¹æ‰€æœ‰æƒ…å†µ)
  function scrollChatToBottom() {
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // å‘é€æ¶ˆæ¯ (æ ¸å¿ƒä¿ç•™)
  async function sendMsg() {
    const input = document.getElementById('msg-input');
    const val = input.value.trim();
    if(!val) return;
    
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    addMessageToChat('me', val);
    input.value = '';
    scrollChatToBottom();

    // æ¨¡æ‹ŸAIå›å¤
    setTimeout(async () => {
      let aiText = '';
      if (apiSettings.url && apiSettings.key && apiSettings.model) {
        aiText = `(æ¨¡å‹ ${apiSettings.model}) ${aiResponses[Math.floor(Math.random() * aiResponses.length)]}`;
      } else {
        aiText = "è¯·åœ¨ã€Œæˆ‘â†’èŠå¤©è®¾ç½®ã€ä¸­é…ç½® API ä¿¡æ¯ï¼";
      }
      addMessageToChat('ai', aiText);
      scrollChatToBottom();
    }, 800 + Math.random() * 500);
  }

  // æ·»åŠ æ¶ˆæ¯å¹¶ä¿å­˜
  function addMessageToChat(sender, text) {
    chatBox.innerHTML += `<div class="chat-bubble ${sender}">${text}</div>`;
    chatHistory.push({ sender, text });
    localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
  }

  // æ¸…ç©ºèŠå¤©è®°å½•
  function clearChatHistory() {
    if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
      chatHistory = [];
      localStorage.removeItem('aiChatHistory');
      chatBox.innerHTML = '';
      addMessageToChat('ai', 'èŠå¤©è®°å½•å·²æ¸…ç©ºï¼Œå¼€å§‹æ–°çš„å¯¹è¯å§ï¼');
      scrollChatToBottom();
    }
  }

  // åˆ‡æ¢èŠå¤©Appå†…Tab (æ¶ˆæ¯/è”ç³»äºº/åŠ¨æ€/æˆ‘)
  let currentChatTab = 'messages';
  function switchChatTab(tabName) {
    // éšè—æ‰€æœ‰Tab
    document.querySelectorAll('#app-chat .chat-tab-content').forEach(content => {
      content.classList.remove('active');
    });
    // å–æ¶ˆæ‰€æœ‰TabæŒ‰é’®æ¿€æ´»
    document.querySelectorAll('#chat-tab-bar .chat-tab-item').forEach(item => {
      item.classList.remove('active');
    });
    // æ¿€æ´»ç›®æ ‡Tab
    document.getElementById(`chat-tab-${tabName}`).classList.add('active');
    document.querySelector(`#chat-tab-bar .chat-tab-item[data-tab="${tabName}"]`).classList.add('active');
    currentChatTab = tabName;
    // æ¶ˆæ¯Tabè‡ªåŠ¨æ»šåˆ°åº•éƒ¨
    if (tabName === 'messages') scrollChatToBottom();
  }

  // æ‰“å¼€å•èŠçª—å£ (é¢„ç•™åŠŸèƒ½)
  function openChat(name) {
    switchChatTab('messages');
    addMessageToChat('ai', `ä½ å¥½ï¼æˆ‘æ˜¯${name}ï¼Œå¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï½`);
    scrollChatToBottom();
  }

  // åŠ è½½/ä¿å­˜èŠå¤©è®¾ç½® (ç‹¬ç«‹å­é¡µé¢ä¸“ç”¨)
  function loadChatSettings() {
    document.getElementById('api-url-input').value = apiSettings.url;
    document.getElementById('api-key-input').value = apiSettings.key;
    // åŠ è½½æ¨¡å‹åˆ—è¡¨
    const modelSelect = document.getElementById('ai-model-select');
    modelSelect.innerHTML = '';
    availableModels.forEach(model => {
      const option = document.createElement('option');
      option.value = model.id;
      option.innerText = model.name;
      modelSelect.appendChild(option);
    });
    modelSelect.value = apiSettings.model;
  }
  function saveChatSettings() {
    apiSettings.url = document.getElementById('api-url-input').value.trim();
    apiSettings.key = document.getElementById('api-key-input').value.trim();
    apiSettings.model = document.getElementById('ai-model-select').value;
    localStorage.setItem('chatApiSettings', JSON.stringify(apiSettings));
    alert('èŠå¤©è®¾ç½®å·²ä¿å­˜ï¼');
    // ä¿å­˜åè¿”å›ä¸Šä¸€çº§
    closeSubpage('app-chat-settings');
  }

  // é¡µé¢åŠ è½½åˆå§‹åŒ–èŠå¤©è®¾ç½®
  document.addEventListener('DOMContentLoaded', loadChatSettings);
</script>
</body>
</html>
