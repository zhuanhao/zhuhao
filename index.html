<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<!-- 1. å¼€å¯â€œçœŸÂ·å…¨å±â€æ¨¡å¼çš„å…³é”®ä»£ç  -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">

<link rel="manifest" href="./manifest.json"> 
<link rel="apple-touch-icon" href="./icon-192.png"> 

<title>AI OS</title>
<style>
  /* --- åŸºç¡€é‡ç½® --- */
  * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; margin: 0; }
  body {
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100dvh;
    font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    overflow: hidden;
  }

  /* --- æ‰‹æœºå®¹å™¨ --- */
  .phone-frame {
    width: 100%; height: 100%; max-width: 420px;
    background: #000; position: relative; overflow: hidden;
  }

  /* --- å±å¹•å£çº¸ --- */
  .screen {
    width: 100%; height: 100%;
    background: url('https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?q=80&w=1000&auto=format&fit=crop') center/cover;
    position: relative; display: flex; flex-direction: column;
    transition: filter 0.3s;
  }

  /* --- é¡¶éƒ¨çŠ¶æ€æ  --- */
  .status-bar {
    position: absolute; top: 0; left: 0; right: 0;
    height: 48px; display: flex; justify-content: space-between; align-items: flex-end;
    padding: calc(10px + env(safe-area-inset-top)) 24px 10px;
    color: white; font-size: 15px; font-weight: 600; z-index: 100;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  .carrier-name { font-size: 14px; font-weight: 500; }
  
  .battery-container { display: flex; align-items: center; gap: 6px; }
  .battery-icon {
    width: 26px; height: 12px; border: 2px solid rgba(255,255,255,0.8); border-radius: 3px;
    position: relative; padding: 1px;
  }
  .battery-icon::after {
    content: ''; position: absolute; right: -4px; top: 2px;
    width: 2px; height: 4px; background: rgba(255,255,255,0.8); border-radius: 0 2px 2px 0;
  }
  .battery-level { height: 100%; background: white; border-radius: 1px; width: 60%; transition: width 0.5s; }
  .charging-bolt { display: none; font-size: 10px; }
  .charging .charging-bolt { display: block; }
  .charging .battery-level { background: #34c759; }

  /* --- çµåŠ¨å²› --- */
  .dynamic-island {
    position: absolute; top: calc(11px + env(safe-area-inset-top)); left: 50%; transform: translateX(-50%);
    width: 110px; height: 32px; background: #000; border-radius: 20px; z-index: 101;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex; justify-content: center; align-items: center;
    color: white; font-size: 14px; overflow: hidden;
  }
  .dynamic-island.expanded {
    width: 90%; max-width: 360px; height: 56px; border-radius: 30px;
    justify-content: flex-start; padding: 0 15px; gap: 10px;
  }
  .dynamic-island img.album-art { width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0; display: none; }
  .dynamic-island.expanded img.album-art { display: block; }
  .dynamic-island .text-content {
    flex-grow: 1; display: none; flex-direction: column; text-align: left;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .dynamic-island.expanded .text-content { display: flex; }
  .dynamic-island .title { font-weight: 600; font-size: 15px; }
  .dynamic-island .artist { font-size: 12px; opacity: 0.7; }
  .dynamic-island .controls { display: none; gap: 15px; font-size: 20px; }
  .dynamic-island.expanded .controls { display: flex; }

  /* --- é¡µé¢åˆ‡æ¢é€»è¾‘ --- */
  .page {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #fff; display: none; flex-direction: column;
    transform-origin: center bottom;
    padding-top: calc(48px + env(safe-area-inset-top));
    padding-bottom: calc(5px + 8px + env(safe-area-inset-bottom));
  }
  #lock-screen {
    background: transparent; align-items: center; color: white;
    padding-top: calc(120px + env(safe-area-inset-top));
    padding-bottom: calc(50px + env(safe-area-inset-bottom));
    z-index: 50; text-align: center;
  }
  #home-screen { 
    background: transparent; 
    padding-top: calc(70px + env(safe-area-inset-top)); 
    padding-bottom: calc(20px + env(safe-area-inset-bottom)); 
    z-index: 40; 
  }

  .page.active { display: flex; animation: appOpen 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
  @keyframes appOpen { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

  /* --- 1. é”å± --- */
  .clock-large { font-size: 86px; font-weight: 200; letter-spacing: -2px; line-height: 1; }
  .date-text { font-size: 20px; margin-top: 10px; font-weight: 500; opacity: 0.9; }
  .unlock-hint { margin-top: auto; opacity: 0.6; font-size: 14px; animation: pulse 2s infinite; }
  @keyframes pulse { 0% {opacity:0.3} 50% {opacity:0.8} 100% {opacity:0.3} }

  /* --- 2. æ¡Œé¢ --- */
  .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; row-gap: 30px; }
  .app-item { display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.1s;}
  .app-item:active { opacity: 0.6; transform: scale(0.95); }
  
  .app-icon { 
    width: 60px; height: 60px; border-radius: 16px; 
    display: flex; justify-content: center; align-items: center; 
    font-size: 28px; color: white; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
  }
  .app-icon.camera { background: linear-gradient(135deg, #ff5722, #ff9800); }
  .app-icon.phone { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
  .app-icon.browser { background: linear-gradient(135deg, #2196F3, #03A9F4); }
  .app-icon.music { background: linear-gradient(135deg, #9C27B0, #E040FB); }
  .app-icon.mail { background: linear-gradient(135deg, #F44336, #FF7043); }

  .app-name { color: white; font-size: 12px; font-weight: 500; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
  
  .dock {
    margin-top: auto; background: rgba(255,255,255,0.25); backdrop-filter: blur(20px);
    border-radius: 32px; padding: 18px; display: flex; justify-content: space-around; 
    margin-bottom: env(safe-area-inset-bottom);
    width: 100%; box-sizing: border-box;
  }
  .dock .app-item { margin: 0; flex-basis: 25%; }
  .dock .app-item .app-icon { width: 50px; height: 50px; font-size: 24px; }
  .dock .app-item .app-name { margin-top: 5px; }

  /* --- App å†…éƒ¨æ ·å¼ --- */
  .app-header { 
    position: absolute; top: 0; left: 0; right: 0; 
    height: 96px; 
    padding: calc(50px + env(safe-area-inset-top)) 20px 10px; 
    background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.1); 
    font-weight: 700; font-size: 22px; 
    display: flex; align-items: center; justify-content: space-between;
    z-index: 10;
  }
  .app-content { flex: 1; overflow-y: auto; padding: 20px; background: #f2f2f7; }

  /* èŠå¤©æ°”æ³¡ */
  .chat-bubble { padding: 12px 18px; border-radius: 20px; max-width: 85%; margin-bottom: 12px; font-size: 16px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
  .chat-bubble.ai { background: #fff; align-self: flex-start; border-bottom-left-radius: 4px; }
  .chat-bubble.me { background: #007aff; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
  
  /* åº•éƒ¨è¾“å…¥æ¡† */
  .input-area { 
    position: absolute; bottom: 0; left: 0; right: 0; 
    padding: 12px 15px calc(30px + env(safe-area-inset-bottom)) 15px; 
    background: #fff; display: flex; gap:10px; border-top: 1px solid #eee; 
    z-index: 10;
  }
  .input-area input { flex: 1; height: 40px; padding: 0 15px; border: 1px solid #e0e0e0; border-radius: 20px; font-size: 16px; outline: none; background: #f5f5f5; }
  .input-area input:focus { background: #fff; border-color: #007aff; }

  /* è®¾ç½®é¡µé¢å¼€å…³æ ·å¼ */
  .toggle-switch {
    width: 50px; height: 30px; background: #e9e9ea; border-radius: 15px; position: relative;
    transition: background-color 0.3s;
  }
  .toggle-switch.on { background-color: #34c759; }
  .toggle-switch .slider {
    width: 26px; height: 26px; background: white; border-radius: 50%; position: absolute;
    top: 2px; left: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: left 0.3s;
  }
  .toggle-switch.on .slider { left: 22px; }

  /* åº•éƒ¨é»‘æ¡ */
  .home-bar {
    position: absolute; left: 50%; transform: translateX(-50%);
    width: 130px; height: 5px; background: #fff; border-radius: 3px; z-index: 999; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    bottom: calc(8px + env(safe-area-inset-bottom)); 
  }

  /* --- èŠå¤© App ä¸“ç”¨æ ·å¼ --- */
  #app-chat {
    display: flex;
    flex-direction: column;
    /* èŠå¤© App å¤´éƒ¨åº•éƒ¨éƒ½æœ‰è‡ªå·±çš„å†…å®¹ï¼Œæ‰€ä»¥ page çš„ padding ç»Ÿä¸€ä¸º 0 */
    padding-top: 0; 
    padding-bottom: 0;
  }
  .chat-main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* éšè—æ¶ˆæ¯/è®¾ç½®é¡µé¢çš„æº¢å‡º */
  }
  .chat-tab-content {
    flex: 1;
    overflow-y: auto; /* åªæœ‰å½“å‰æ˜¾ç¤ºçš„tabå†…å®¹éœ€è¦æ»šåŠ¨ */
    background: #f2f2f7;
    padding: 20px;
    display: none; /* é»˜è®¤éšè—æ‰€æœ‰tabå†…å®¹ */
  }
  .chat-tab-content.active {
    display: flex; /* åªæ˜¾ç¤ºæ¿€æ´»çš„tabå†…å®¹ */
    flex-direction: column;
  }
  .chat-tab-bar {
    height: 60px;
    background: #f8f8f8;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding-bottom: env(safe-area-inset-bottom); /* é€‚é…åº•éƒ¨å®‰å…¨åŒºåŸŸ */
  }
  .chat-tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 10px;
    color: #8e8e93;
    transition: color 0.2s;
  }
  .chat-tab-item.active {
    color: #007aff;
  }
  .chat-tab-item .icon {
    font-size: 22px;
    margin-bottom: 2px;
  }

  /* èŠå¤©è®¾ç½®é¡µé¢æ ·å¼ */
  .settings-section {
    background: white;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    overflow: hidden;
  }
  .settings-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
    color: #333;
  }
  .settings-item:last-child {
    border-bottom: none;
  }
  .settings-item span:first-child {
    flex-grow: 1;
  }
  .settings-item input[type="text"], .settings-item input[type="password"], .settings-item select {
    flex-shrink: 0;
    width: 60%;
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
  }
  .settings-item select {
    appearance: none; /* ç§»é™¤é»˜è®¤ä¸‹æ‹‰ç®­å¤´ */
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M5%207l5%205%205-5z%22%20fill%3D%22%23888%22%2F%3E%3C%2Fsvg%3E');
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 30px; /* ä¸ºç®­å¤´ç•™å‡ºç©ºé—´ */
  }
  .settings-item-label {
    width: 30%;
    flex-shrink: 0;
    margin-right: 10px;
  }
  .settings-button {
    background: #007aff;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-size: 17px;
    font-weight: 600;
    width: 100%;
    text-align: center;
    cursor: pointer;
    transition: background 0.2s;
  }
  .settings-button:active {
    background: #005bb5;
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar">
      <span class="carrier-name">AI_Link</span>
      <span id="clock-small">--:--</span>
      <div class="battery-container" id="battery-box">
        <span class="charging-bolt">âš¡</span>
        <span id="batt-text" style="font-size:12px; margin-right:4px;"></span>
        <div class="battery-icon">
          <div class="battery-level" id="batt-level"></div>
        </div>
      </div>
    </div>
    
    <!-- çµåŠ¨å²› -->
    <div class="dynamic-island" id="dynamic-island-display" onclick="toggleDynamicIsland()">
      <img src="https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ" alt="Album Art" class="album-art" id="album-art">
      <div class="text-content">
        <div class="title" id="song-title">æ­Œæ›²åç§°</div>
        <div class="artist" id="song-artist">è‰ºæœ¯å®¶</div>
      </div>
      <div class="controls">
        <span onclick="event.stopPropagation(); console.log('Previous Track')">â®</span>
        <span onclick="event.stopPropagation(); togglePlayPause()" id="play-pause-btn">â¯</span>
        <span onclick="event.stopPropagation(); console.log('Next Track')">â­</span>
      </div>
    </div>

    <!-- 1. é”å± -->
    <div id="lock-screen" class="page active" onclick="unlock()">
      <div>
        <div class="clock-large" id="clock-large">12:00</div>
        <div class="date-text" id="date-text">10æœˆ24æ—¥ æ˜ŸæœŸäºŒ</div>
      </div>
      <div class="unlock-hint">å‘ä¸Šæ»‘åŠ¨è§£é”</div>
    </div>

    <!-- 2. æ¡Œé¢ -->
    <div id="home-screen" class="page">
      <div class="app-grid">
        <div class="app-item" onclick="openApp('app-chat')">
          <div class="app-icon" style="background: linear-gradient(135deg, #30cfd0, #330867);">ğŸ’¬</div>
          <span class="app-name">èŠå¤©</span> <!-- ä¿®æ”¹ App åç§° -->
        </div>
        <div class="app-item" onclick="openApp('app-lore')">
          <div class="app-icon" style="background: linear-gradient(135deg, #d299c2, #fef9d7);">ğŸ“–</div>
          <span class="app-name">ä¸–ç•Œä¹¦</span>
        </div>
        <div class="app-item" onclick="openApp('app-settings')">
          <div class="app-icon" style="background: linear-gradient(135deg, #a1c4fd, #c2e9fb);">âš™ï¸</div>
          <span class="app-name">è®¾ç½®</span>
        </div>
        <div class="app-item">
          <div class="app-icon camera">ğŸ“·</div>
          <span class="app-name">ç›¸æœº</span>
        </div>
      </div>

      <div class="dock">
        <div class="app-item"><div class="app-icon phone">ğŸ“</div><span class="app-name">ç”µè¯</span></div>
        <div class="app-item"><div class="app-icon browser">ğŸŒ</div><span class="app-name">æµè§ˆå™¨</span></div>
        <div class="app-item"><div class="app-icon music">ğŸµ</div><span class="app-name">éŸ³ä¹</span></div>
        <div class="app-item"><div class="app-icon mail">âœ‰ï¸</div><span class="app-name">é‚®ä»¶</span></div>
      </div>
    </div>

    <!-- 3. App: èŠå¤© -->
    <div id="app-chat" class="page">
      <div class="app-header">
        <span id="chat-header-title">èŠå¤©</span> <!-- åŠ¨æ€æ ‡é¢˜ -->
        <!-- èŠå¤© App å†…éƒ¨çš„è¿”å›æŒ‰é’®ï¼Œè¿”å›åˆ°èŠå¤©ä¸»ç•Œé¢æˆ–è®¾ç½® -->
        <span id="chat-back-button" onclick="chatGoBack()" style="font-size:14px; color:#007aff; font-weight:400; display:none;">è¿”å›</span>
        <span id="chat-settings-button" onclick="showChatSettings()" style="font-size:14px; color:#007aff; font-weight:400;">è®¾ç½®</span>
      </div>
      
      <div class="chat-main-content">
        <!-- æ¶ˆæ¯ Tab å†…å®¹ -->
        <div id="chat-tab-messages" class="chat-tab-content active">
          <div class="chat-box" id="chat-box" style="display:flex; flex-direction:column;"></div>
          <div class="input-area">
            <input type="text" id="msg-input" placeholder="å‘æ¶ˆæ¯..." onkeydown="if(event.key === 'Enter') sendMsg()">
            <button onclick="sendMsg()" style="border:none; background:none; color:#007aff; font-weight:bold; font-size:16px;">â†‘</button>
          </div>
        </div>

        <!-- è”ç³»äºº Tab å†…å®¹ -->
        <div id="chat-tab-contacts" class="chat-tab-content">
          <div class="settings-section">
            <div class="settings-item">AI åŠ©æ‰‹</div>
            <div class="settings-item">çµçŠ€</div>
            <div class="settings-item">å°çˆ±</div>
          </div>
        </div>

        <!-- åŠ¨æ€ Tab å†…å®¹ -->
        <div id="chat-tab-moments" class="chat-tab-content">
          <div class="settings-section" style="text-align: center; padding: 20px; color: #888;">
            æš‚æ— åŠ¨æ€ï¼Œå¿«å»åˆ†äº«ä½ çš„ç”Ÿæ´»å§ï¼
          </div>
        </div>

        <!-- æˆ‘ Tab å†…å®¹ -->
        <div id="chat-tab-me" class="chat-tab-content">
          <div class="settings-section">
            <div class="settings-item">æˆ‘çš„æ˜µç§° <span style="color:#888">AI ç”¨æˆ·</span></div>
            <div class="settings-item">æˆ‘çš„è´¦å· <span style="color:#888">12345678</span></div>
            <div class="settings-item" onclick="showChatSettings()">è®¾ç½® ></div>
          </div>
        </div>

        <!-- èŠå¤© App å†…éƒ¨çš„è®¾ç½®é¡µé¢ -->
        <div id="chat-tab-settings" class="chat-tab-content">
          <div class="settings-section">
            <div class="settings-item">
              <span class="settings-item-label">API URL</span>
              <input type="text" id="api-url-input" placeholder="http://localhost:8000/chat">
            </div>
            <div class="settings-item">
              <span class="settings-item-label">API Key</span>
              <input type="password" id="api-key-input" placeholder="ä½ çš„ API å¯†é’¥">
            </div>
            <div class="settings-item">
              <span class="settings-item-label">AI æ¨¡å‹</span>
              <select id="ai-model-select"></select>
            </div>
            <div class="settings-item">
              <button class="settings-button" onclick="saveChatSettings()">ä¿å­˜è®¾ç½®</button>
            </div>
          </div>
          <div class="settings-section">
            <div class="settings-item">
              <span>æ¸…ç©ºèŠå¤©è®°å½•</span>
              <button onclick="clearChatHistory()" style="background: #ff3b30; color: white; border: none; border-radius: 8px; padding: 8px 12px;">æ¸…ç©º</button>
            </div>
          </div>
        </div>
      </div>

      <!-- èŠå¤© App åº•éƒ¨å¯¼èˆªæ  -->
      <div class="chat-tab-bar" id="chat-tab-bar">
        <div class="chat-tab-item active" data-tab="messages" onclick="switchChatTab('messages')">
          <span class="icon">ğŸ’¬</span> <span>æ¶ˆæ¯</span>
        </div>
        <div class="chat-tab-item" data-tab="contacts" onclick="switchChatTab('contacts')">
          <span class="icon">ğŸ‘¥</span> <span>è”ç³»äºº</span>
        </div>
        <div class="chat-tab-item" data-tab="moments" onclick="switchChatTab('moments')">
          <span class="icon">âœ¨</span> <span>åŠ¨æ€</span>
        </div>
        <div class="chat-tab-item" data-tab="me" onclick="switchChatTab('me')">
          <span class="icon">ğŸ‘¤</span> <span>æˆ‘</span>
        </div>
      </div>
    </div>

    <!-- 4. App: ä¸–ç•Œä¹¦ -->
    <div id="app-lore" class="page">
      <div class="app-header">ä¸–ç•Œä¹¦ <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span></div>
      <div class="app-content">
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">è§’è‰²ï¼šçµçŠ€</strong><br>
          <span style="color:#666; font-size:14px">ä½ çš„å…¨èƒ½ AI åŠ©ç†ï¼Œå½“å‰è¿è¡Œåœ¨ WebOS 2.0 ç‰ˆæœ¬ã€‚</span>
        </div>
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">ä¸–ç•Œè§‚ï¼šèµ›åšæœ‹å…‹ 2077</strong><br>
          <span style="color:#666; font-size:14px">ä¸€ä¸ªç”±å·¨å‹ä¼ä¸šç»Ÿæ²»ï¼ŒæŠ€æœ¯é«˜åº¦å‘è¾¾ä½†ç¤¾ä¼šè´«å¯Œå·®è·å·¨å¤§çš„åä¹Œæ‰˜é‚¦æœªæ¥ä¸–ç•Œã€‚</span>
        </div>
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">æŠ€æœ¯ï¼šçµé­‚èŠ¯ç‰‡ (Soul Chip)</strong><br>
          <span style="color:#666; font-size:14px">èƒ½å¤Ÿå­˜å‚¨äººç±»æ„è¯†å’Œè®°å¿†çš„ç”Ÿç‰©æŠ€æœ¯èŠ¯ç‰‡ï¼Œæ˜¯æ°¸ç”Ÿçš„å¸Œæœ›ï¼Œä¹Ÿæ˜¯æƒåŠ›æ–—äº‰çš„ç„¦ç‚¹ã€‚</span>
        </div>
      </div>
    </div>

    <!-- 5. App: è®¾ç½® -->
    <div id="app-settings" class="page">
      <div class="app-header">è®¾ç½® <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span></div>
      <div class="app-content" style="background:#fff">
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>é£è¡Œæ¨¡å¼</span> 
          <div class="toggle-switch" id="airplane-mode-toggle" onclick="toggleSetting('airplane-mode-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>Wi-Fi</span> 
          <div class="toggle-switch on" id="wifi-toggle" onclick="toggleSetting('wifi-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px; border-bottom:1px solid #eee;">Wi-Fi ç½‘ç»œ <span style="float:right;color:#888">AI_Link_5G ></span></div>
        <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
          <span>è“ç‰™</span> 
          <div class="toggle-switch on" id="bluetooth-toggle" onclick="toggleSetting('bluetooth-toggle')">
            <div class="slider"></div>
          </div>
        </div>
        <div style="padding:15px; border-bottom:1px solid #eee;">é€šç”¨ <span style="float:right;color:#888">></span></div>
        <div style="padding:15px; border-bottom:1px solid #eee;">å£çº¸ <span style="float:right;color:#888">></span></div>
      </div>
    </div>

    <div class="home-bar" onclick="goHome()"></div>
  </div>
</div>

<script>
  // ====================================================================
  // 1. å…¨å±€ç³»ç»ŸåŠŸèƒ½ (æ—¶é—´ã€ç”µæ± ã€App åˆ‡æ¢)
  // ====================================================================

  // --- æ—¶é—´åŒæ­¥é€»è¾‘ (Real Time) ---
  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const timeStr = `${h}:${m}`;
    
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    const week = weekDays[now.getDay()];
    const dateStr = `${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${week}`;

    document.getElementById('clock-small').innerText = timeStr;
    document.getElementById('clock-large').innerText = timeStr;
    document.getElementById('date-text').innerText = dateStr;
  }
  setInterval(updateClock, 1000);
  updateClock();

  // --- çœŸå®ç”µæ± é€»è¾‘ (Battery API) ---
  function initBattery() {
    const battLevelEl = document.getElementById('batt-level');
    const battTextEl = document.getElementById('batt-text');
    const battBoxEl = document.getElementById('battery-box');
    
    if (navigator.getBattery) {
      navigator.getBattery().then(battery => {
        updateBatteryUI(battery);
        battery.addEventListener('levelchange', () => updateBatteryUI(battery));
        battery.addEventListener('chargingchange', () => updateBatteryUI(battery));
      });
    } else {
      const simulatedLevel = Math.floor(Math.random() * 30) + 70;
      battLevelEl.style.width = `${simulatedLevel}%`;
      battTextEl.innerText = `${simulatedLevel}%`;
      if (Math.random() > 0.7) {
          battBoxEl.classList.add('charging');
      }
    }

    function updateBatteryUI(battery) {
      const level = Math.floor(battery.level * 100);
      battLevelEl.style.width = `${level}%`;
      battTextEl.innerText = `${level}%`;
      
      if(level <= 20 && !battery.charging) battLevelEl.style.background = '#ff3b30';
      else battLevelEl.style.background = 'white';
      
      if(battery.charging) {
        battBoxEl.classList.add('charging');
      } else {
        battBoxEl.classList.remove('charging');
      }
    }
  }
  initBattery();

  // --- App åˆ‡æ¢é€»è¾‘ ---
  let currentApp = 'lock-screen';

  function unlock() {
    const lock = document.getElementById('lock-screen');
    lock.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
    lock.style.transform = 'translateY(-100%)';
    setTimeout(() => {
      lock.classList.remove('active');
      lock.style.transform = '';
      document.getElementById('home-screen').classList.add('active');
      currentApp = 'home-screen';
    }, 400);
  }

  function openApp(id) {
    const activePage = document.querySelector('.page.active');
    if (activePage) {
      activePage.classList.remove('active');
    }
    document.getElementById(id).classList.add('active');
    currentApp = id;

    // å¦‚æœæ‰“å¼€çš„æ˜¯èŠå¤©Appï¼Œåˆå§‹åŒ–èŠå¤©å†…å®¹
    if (id === 'app-chat') {
        loadChatHistory();
        scrollChatToBottom();
        switchChatTab('messages'); // é»˜è®¤æ˜¾ç¤ºæ¶ˆæ¯tab
    }
  }

  function goHome() {
    const activePage = document.querySelector('.page.active');
    if (activePage && activePage.id !== 'home-screen' && activePage.id !== 'lock-screen') {
      activePage.style.transition = 'transform 0.3s cubic-bezier(0.55, 0.085, 0.68, 0.53), opacity 0.3s ease-out';
      activePage.style.transform = 'scale(0.9)';
      activePage.style.opacity = '0';
      setTimeout(() => {
        activePage.classList.remove('active');
        activePage.style = '';
      }, 300);
    }
    document.getElementById('home-screen').classList.add('active');
    currentApp = 'home-screen';
  }

  // --- çµåŠ¨å²›éŸ³ä¹æ’­æ”¾é€»è¾‘ ---
  let isPlaying = false;
  let dynamicIslandExpanded = false;
  const dynamicIslandEl = document.getElementById('dynamic-island-display');
  const songTitleEl = document.getElementById('song-title');
  const songArtistEl = document.getElementById('song-artist');
  const albumArtEl = document.getElementById('album-art');
  const playPauseBtnEl = document.getElementById('play-pause-btn');
  const dynamicIslandTextContentEl = dynamicIslandEl.querySelector('.text-content');
  const dynamicIslandControlsEl = dynamicIslandEl.querySelector('.controls');

  function updateDynamicIsland(playing, title = "æœªæ’­æ”¾", artist = "æœªçŸ¥", albumArt = "https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ") {
    isPlaying = playing;
    if (isPlaying) {
      albumArtEl.src = albumArt;
      songTitleEl.innerText = title;
      songArtistEl.innerText = artist;
      playPauseBtnEl.innerText = 'â¸'; 
      
      albumArtEl.style.display = 'block';
      dynamicIslandTextContentEl.style.display = 'flex';
      dynamicIslandControlsEl.style.display = 'flex';

      dynamicIslandEl.classList.add('expanded');
      dynamicIslandExpanded = true;
    } else {
      albumArtEl.style.display = 'none';
      dynamicIslandTextContentEl.style.display = 'none';
      dynamicIslandControlsEl.style.display = 'none';

      dynamicIslandEl.classList.remove('expanded');
      dynamicIslandExpanded = false;
    }
  }

  function togglePlayPause() {
    isPlaying = !isPlaying;
    playPauseBtnEl.innerText = isPlaying ? 'â¸' : 'â¯';
    console.log(`Music is now ${isPlaying ? 'playing' : 'paused'}`);
    
    if (!isPlaying && dynamicIslandExpanded) {
        setTimeout(() => {
            if (!isPlaying) {
                dynamicIslandEl.classList.remove('expanded');
                dynamicIslandExpanded = false;
            }
        }, 3000);
    }
  }

  function toggleDynamicIsland() {
    if (isPlaying) {
      dynamicIslandExpanded = !dynamicIslandExpanded;
      if (dynamicIslandExpanded) {
        dynamicIslandEl.classList.add('expanded');
      } else {
        dynamicIslandEl.classList.remove('expanded');
      }
    } else {
      console.log("çµåŠ¨å²›è¢«ç‚¹å‡»ï¼Œä½†æ²¡æœ‰éŸ³ä¹åœ¨æ’­æ”¾ã€‚");
    }
  }

  setTimeout(() => {
    updateDynamicIsland(true, "AIä¹‹æ­Œ", "çµçŠ€", "https://i.scdn.co/image/ab67616d0000b273d4029191d90fcc1a896d84a7");
  }, 3000);

  // --- ç³»ç»Ÿè®¾ç½®å¼€å…³é€»è¾‘ ---
  function toggleSetting(id) {
    const toggle = document.getElementById(id);
    toggle.classList.toggle('on');
    console.log(`${id} is now ${toggle.classList.contains('on') ? 'on' : 'off'}`);
  }

  // ====================================================================
  // 2. èŠå¤© App åŠŸèƒ½ (æ¶ˆæ¯ã€è”ç³»äººã€åŠ¨æ€ã€æˆ‘ã€è®¾ç½®)
  // ====================================================================

  // AI èŠå¤©å›å¤é€»è¾‘ (ç°åœ¨åªæ˜¯æ¨¡æ‹Ÿï¼Œæœªæ¥å¯ä»¥æ›¿æ¢ä¸ºçœŸæ­£çš„APIè°ƒç”¨)
  const aiResponses = [
    "å¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï¼", "æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ", "è¯·å‘Šè¯‰æˆ‘æ›´å¤šç»†èŠ‚ã€‚", "æˆ‘æ­£åœ¨å­¦ä¹ ä¸­ï¼Œè¯·ç¨ç­‰ã€‚",
    "è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼", "å¥½çš„ï¼Œæˆ‘æ˜ç™½äº†ã€‚", "æˆ‘ä»¬ç»§ç»­èŠèŠå§ã€‚", "å¾ˆé«˜å…´èƒ½å’Œä½ äº¤æµï¼",
    "è¯·é—®ä½ æœ‰ä»€ä¹ˆæ–°çš„æƒ³æ³•å—ï¼Ÿ", "æ€è€ƒä¸­...", "æˆ‘éœ€è¦æ›´å¤šä¿¡æ¯æ‰èƒ½å›ç­”ã€‚", "ä½ æœ€è¿‘è¿‡å¾—å¥½å—ï¼Ÿ",
    "è¿™æ¡æ¶ˆæ¯æ¥è‡ªæ¨¡æ‹Ÿ AIï¼Œè¯·åœ¨è®¾ç½®ä¸­é…ç½® APIã€‚",
    "ä½ é…ç½®äº† API å—ï¼Ÿæˆ‘è¿˜æ²¡æ”¶åˆ°å‘¢ï¼"
  ];
  let chatHistory = []; // å­˜å‚¨èŠå¤©è®°å½•
  const chatBox = document.getElementById('chat-box');

  // API é…ç½®å­˜å‚¨åœ¨ localStorage
  let apiSettings = JSON.parse(localStorage.getItem('chatApiSettings')) || {
    url: '',
    key: '',
    model: ''
  };

  // æ¨¡æ‹Ÿ AI æ¨¡å‹åˆ—è¡¨ (æœªæ¥å¯ä» API æ‹‰å–)
  const availableModels = [
    { id: 'gpt-3.5-turbo', name: 'GPT-3.5 Turbo' },
    { id: 'gpt-4o', name: 'GPT-4o' },
    { id: 'kimi-moonshot', name: 'Kimi Moonshot' },
    { id: 'gemini-pro', name: 'Gemini Pro' }
  ];

  // åŠ è½½èŠå¤©å†å²
  function loadChatHistory() {
    const storedHistory = localStorage.getItem('aiChatHistory');
    if (storedHistory) {
      chatHistory = JSON.parse(storedHistory);
      chatBox.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
      chatHistory.forEach(msg => {
        chatBox.innerHTML += `<div class="chat-bubble ${msg.sender}">${msg.text}</div>`;
      });
    } else {
      // é¦–æ¬¡åŠ è½½æˆ–æ¸…ç©ºåï¼Œæ·»åŠ æ¬¢è¿æ¶ˆæ¯
      chatBox.innerHTML = `<div class="chat-bubble ai">ä½ å¥½ï¼ç³»ç»Ÿæ—¶é—´å·²åŒæ­¥ã€‚</div>
                           <div class="chat-bubble ai">ç”µé‡æ¨¡å—å·²æ ¡å‡†ã€‚</div>
                           <div class="chat-bubble ai">çµåŠ¨å²›åŠŸèƒ½å·²å°±ç»ªï¼Œç‚¹å‡»è¯•è¯•çœ‹ï¼</div>`;
      chatHistory = [
        { sender: 'ai', text: 'ä½ å¥½ï¼ç³»ç»Ÿæ—¶é—´å·²åŒæ­¥ã€‚' },
        { sender: 'ai', text: 'ç”µé‡æ¨¡å—å·²æ ¡å‡†ã€‚' },
        { sender: 'ai', text: 'çµåŠ¨å²›åŠŸèƒ½å·²å°±ç»ªï¼Œç‚¹å‡»è¯•è¯•çœ‹ï¼' }
      ];
      localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
    }
  }

  // æ»šåŠ¨èŠå¤©åˆ°åº•éƒ¨
  function scrollChatToBottom() {
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // å‘é€æ¶ˆæ¯
  async function sendMsg() {
    const input = document.getElementById('msg-input');
    const val = input.value.trim();
    if(!val) return;
    
    // ç”¨æˆ·æ¶ˆæ¯
    addMessageToChat('me', val);
    input.value = '';
    scrollChatToBottom();

    // æ¨¡æ‹Ÿ AI å›å¤æˆ–è°ƒç”¨å®é™… API
    setTimeout(async () => {
      let aiText = '';
      if (apiSettings.url && apiSettings.key && apiSettings.model) {
        // å®é™… API è°ƒç”¨é€»è¾‘ (è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼Œä½ å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„ fetch è¯·æ±‚)
        console.log("å°è¯•è°ƒç”¨ AI API:", apiSettings.url, apiSettings.model);
        // å‡è®¾è¿™é‡Œæœ‰ä¸€ä¸ªçœŸæ­£çš„ API è°ƒç”¨
        // try {
        //     const response = await fetch(apiSettings.url, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json',
        //             'Authorization': `Bearer ${apiSettings.key}`
        //         },
        //         body: JSON.stringify({
        //             model: apiSettings.model,
        //             messages: [{ role: 'user', content: val }]
        //         })
        //     });
        //     const data = await response.json();
        //     aiText = data.choices[0].message.content; // å‡è®¾å“åº”æ ¼å¼å¦‚æ­¤
        // } catch (error) {
        //     console.error("API è°ƒç”¨å¤±è´¥:", error);
        //     aiText = "API è°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®æˆ–ç½‘ç»œè¿æ¥ã€‚";
        // }
        
        // æš‚æ—¶è¿˜æ˜¯æ¨¡æ‹Ÿå›å¤
        aiText = aiResponses[Math.floor(Math.random() * aiResponses.length)];
        if (!aiText.includes("API")) aiText = `(æ¨¡å‹ ${apiSettings.model}) ${aiText}`;

      } else {
        aiText = "è¯·åœ¨èŠå¤©è®¾ç½®ä¸­é…ç½® API URLã€Key å’Œæ¨¡å‹ã€‚";
      }
      addMessageToChat('ai', aiText);
      scrollChatToBottom();
    }, 800 + Math.random() * 500); // éšæœºå»¶è¿Ÿ
  }

  // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢å¹¶ä¿å­˜
  function addMessageToChat(sender, text) {
    chatBox.innerHTML += `<div class="chat-bubble ${sender}">${text}</div>`;
    chatHistory.push({ sender, text });
    localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
  }

  // æ¸…ç©ºèŠå¤©è®°å½•
  function clearChatHistory() {
    if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
      chatHistory = [];
      localStorage.removeItem('aiChatHistory');
      chatBox.innerHTML = '';
      addMessageToChat('ai', 'èŠå¤©è®°å½•å·²æ¸…ç©ºã€‚');
      addMessageToChat('ai', 'å¼€å§‹æ–°çš„å¯¹è¯å§ï¼');
      scrollChatToBottom();
    }
  }

  // åˆ‡æ¢èŠå¤© App å†…éƒ¨ Tab
  let currentChatTab = 'messages';
  function switchChatTab(tabName) {
    // éšè—æ‰€æœ‰ Tab å†…å®¹
    document.querySelectorAll('#app-chat .chat-tab-content').forEach(content => {
      content.classList.remove('active');
    });
    // ç§»é™¤æ‰€æœ‰ Tab æŒ‰é’®çš„ active çŠ¶æ€
    document.querySelectorAll('#chat-tab-bar .chat-tab-item').forEach(item => {
      item.classList.remove('active');
    });

    // æ˜¾ç¤ºç›®æ ‡ Tab å†…å®¹
    document.getElementById(`chat-tab-${tabName}`).classList.add('active');
    // æ¿€æ´»ç›®æ ‡ Tab æŒ‰é’®
    document.querySelector(`#chat-tab-bar .chat-tab-item[data-tab="${tabName}"]`).classList.add('active');

    currentChatTab = tabName;
    document.getElementById('chat-header-title').innerText = getChatTabTitle(tabName);
    updateChatHeaderButtons(tabName);

    // æ»šåŠ¨åˆ°æœ€åº•éƒ¨
    if (tabName === 'messages') {
        scrollChatToBottom();
    }
  }

  function getChatTabTitle(tabName) {
      switch(tabName) {
          case 'messages': return 'èŠå¤©';
          case 'contacts': return 'è”ç³»äºº';
          case 'moments': return 'åŠ¨æ€';
          case 'me': return 'æˆ‘';
          case 'settings': return 'èŠå¤©è®¾ç½®';
          default: return 'èŠå¤©';
      }
  }

  function updateChatHeaderButtons(tabName) {
      const backButton = document.getElementById('chat-back-button');
      const settingsButton = document.getElementById('chat-settings-button');

      if (tabName === 'settings') {
          backButton.style.display = 'inline';
          settingsButton.style.display = 'none';
      } else {
          backButton.style.display = 'none';
          settingsButton.style.display = 'inline';
      }
  }

  // æ˜¾ç¤ºèŠå¤©è®¾ç½®é¡µé¢
  function showChatSettings() {
    switchChatTab('settings');
    loadChatSettings(); // åŠ è½½å½“å‰è®¾ç½®åˆ°è¡¨å•
  }

  // èŠå¤©è®¾ç½®é¡µé¢çš„è¿”å›æŒ‰é’®
  function chatGoBack() {
      // ä»è®¾ç½®é¡µé¢è¿”å›åˆ°â€œæˆ‘â€çš„é¡µé¢
      if (currentChatTab === 'settings') {
          switchChatTab('me');
      } else {
          // å…¶ä»–æƒ…å†µå›åˆ°ä¸»é¡µ
          goHome(); 
      }
  }

  // åŠ è½½ API è®¾ç½®åˆ°è¡¨å•
  function loadChatSettings() {
    document.getElementById('api-url-input').value = apiSettings.url;
    document.getElementById('api-key-input').value = apiSettings.key;
    
    const modelSelect = document.getElementById('ai-model-select');
    modelSelect.innerHTML = ''; // æ¸…ç©ºæ—§é€‰é¡¹
    availableModels.forEach(model => {
      const option = document.createElement('option');
      option.value = model.id;
      option.innerText = model.name;
      modelSelect.appendChild(option);
    });
    modelSelect.value = apiSettings.model; // é€‰ä¸­å½“å‰æ¨¡å‹
  }

  // ä¿å­˜ API è®¾ç½®
  function saveChatSettings() {
    apiSettings.url = document.getElementById('api-url-input').value.trim();
    apiSettings.key = document.getElementById('api-key-input').value.trim();
    apiSettings.model = document.getElementById('ai-model-select').value;
    localStorage.setItem('chatApiSettings', JSON.stringify(apiSettings));
    alert('èŠå¤© API è®¾ç½®å·²ä¿å­˜ï¼');
    console.log('ä¿å­˜çš„ API è®¾ç½®:', apiSettings);
    // ä¿å­˜åå¯ä»¥è‡ªåŠ¨è¿”å›åˆ°â€œæˆ‘â€çš„é¡µé¢
    switchChatTab('me'); 
  }

  // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–èŠå¤©è®¾ç½®è¡¨å•
  document.addEventListener('DOMContentLoaded', loadChatSettings);
</script>
</body>
</html>
