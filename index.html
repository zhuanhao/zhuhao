<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">

<link rel="manifest" href="./manifest.json"> 
<link rel="apple-touch-icon" href="./icon-192.png"> 

<title>AI OS</title>
<style>
  /* --- åŸºç¡€é‡ç½® --- */
  * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; margin: 0; }
  body {
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100dvh;
    font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    overflow: hidden;
  }

  /* --- æ‰‹æœºå®¹å™¨ --- */
  .phone-frame {
    width: 100%; height: 100%; max-width: 420px;
    background: #000; position: relative; overflow: hidden;
  }

  /* --- å±å¹•å£çº¸ --- */
  .screen {
    width: 100%; height: 100%;
    background: url('https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?q=80&w=1000&auto=format&fit=crop') center/cover;
    position: relative; display: flex; flex-direction: column;
    transition: filter 0.3s;
  }

  /* --- é¡¶éƒ¨çŠ¶æ€æ  --- */
  .status-bar {
    position: absolute; top: 0; left: 0; right: 0;
    height: 48px; display: flex; justify-content: space-between; align-items: flex-end;
    padding: calc(10px + env(safe-area-inset-top)) 24px 10px;
    color: white; font-size: 15px; font-weight: 600; z-index: 100;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  .carrier-name { font-size: 14px; font-weight: 500; }
  
  .battery-container { display: flex; align-items: center; gap: 6px; }
  .battery-icon {
    width: 26px; height: 12px; border: 2px solid rgba(255,255,255,0.8); border-radius: 3px;
    position: relative; padding: 1px;
  }
  .battery-icon::after {
    content: ''; position: absolute; right: -4px; top: 2px;
    width: 2px; height: 4px; background: rgba(255,255,255,0.8); border-radius: 0 2px 2px 0;
  }
  .battery-level { height: 100%; background: white; border-radius: 1px; width: 60%; transition: width 0.5s; }
  .charging-bolt { display: none; font-size: 10px; }
  .charging .charging-bolt { display: block; }
  .charging .battery-level { background: #34c759; }

  /* --- çµåŠ¨å²› --- */
  .dynamic-island {
    position: absolute; top: calc(11px + env(safe-area-inset-top)); left: 50%; transform: translateX(-50%);
    width: 110px; height: 32px; background: #000; border-radius: 20px; z-index: 101;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex; justify-content: center; align-items: center;
    color: white; font-size: 14px; overflow: hidden;
  }
  .dynamic-island.expanded {
    width: 90%; max-width: 360px; height: 56px; border-radius: 30px;
    justify-content: flex-start; padding: 0 15px; gap: 10px;
  }
  .dynamic-island img.album-art { width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0; display: none; }
  .dynamic-island.expanded img.album-art { display: block; }
  .dynamic-island .text-content {
    flex-grow: 1; display: none; flex-direction: column; text-align: left;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .dynamic-island.expanded .text-content { display: flex; }
  .dynamic-island .title { font-weight: 600; font-size: 15px; }
  .dynamic-island .artist { font-size: 12px; opacity: 0.7; }
  .dynamic-island .controls { display: none; gap: 15px; font-size: 20px; }
  .dynamic-island.expanded .controls { display: flex; }

  /* --- é¡µé¢åˆ‡æ¢é€»è¾‘ --- */
  .page {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #fff; display: none; flex-direction: column;
    transform-origin: center bottom;
    /* é»˜è®¤ paddingï¼Œä¸ªåˆ« App ä¼šè¦†ç›– */
    padding-top: calc(48px + env(safe-area-inset-top));
    padding-bottom: calc(5px + 8px + env(safe-area-inset-bottom));
  }
  #lock-screen {
    background: transparent; align-items: center; color: white;
    padding-top: calc(120px + env(safe-area-inset-top));
    padding-bottom: calc(50px + env(safe-area-inset-bottom));
    z-index: 50; text-align: center;
  }
  #home-screen { 
    background: transparent; 
    padding-top: calc(70px + env(safe-area-inset-top)); 
    padding-bottom: calc(20px + env(safe-area-inset-bottom)); 
    z-index: 40; 
  }

  .page.active { display: flex; animation: appOpen 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
  @keyframes appOpen { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

  /* --- 1. é”å± --- */
  .clock-large { font-size: 86px; font-weight: 200; letter-spacing: -2px; line-height: 1; }
  .date-text { font-size: 20px; margin-top: 10px; font-weight: 500; opacity: 0.9; }
  .unlock-hint { margin-top: auto; opacity: 0.6; font-size: 14px; animation: pulse 2s infinite; }
  @keyframes pulse { 0% {opacity:0.3} 50% {opacity:0.8} 100% {opacity:0.3} }

  /* --- 2. æ¡Œé¢ --- */
  .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; row-gap: 30px; }
  .app-item { display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.1s;}
  .app-item:active { opacity: 0.6; transform: scale(0.95); }
  
  .app-icon { 
    width: 60px; height: 60px; border-radius: 16px; 
    display: flex; justify-content: center; align-items: center; 
    font-size: 28px; color: white; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
  }
  .app-icon.camera { background: linear-gradient(135deg, #ff5722, #ff9800); }
  .app-icon.phone { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
  .app-icon.browser { background: linear-gradient(135deg, #2196F3, #03A9F4); }
  .app-icon.music { background: linear-gradient(135deg, #9C27B0, #E040FB); }
  .app-icon.mail { background: linear-gradient(135deg, #F44336, #FF7043); }

  .app-name { color: white; font-size: 12px; font-weight: 500; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
  
  .dock {
    margin-top: auto; background: rgba(255,255,255,0.25); backdrop-filter: blur(20px);
    border-radius: 32px; padding: 18px; display: flex; justify-content: space-around; 
    margin-bottom: env(safe-area-inset-bottom);
    width: 100%; box-sizing: border-box;
  }
  .dock .app-item { margin: 0; flex-basis: 25%; }
  .dock .app-item .app-icon { width: 50px; height: 50px; font-size: 24px; }
  .dock .app-item .app-name { margin-top: 5px; }

  /* --- é€šç”¨ App å†…éƒ¨æ ·å¼ --- */
  .app-header { 
    /* å¤´éƒ¨å›ºå®šåœ¨é¡¶éƒ¨ */
    flex-shrink: 0;
    height: 96px; 
    padding: calc(50px + env(safe-area-inset-top)) 20px 10px; 
    background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.1); 
    font-weight: 700; font-size: 22px; 
    display: flex; align-items: center; justify-content: space-between;
    z-index: 10;
  }
  /* è¿™é‡Œçš„ app-content ä¸»è¦ç”¨äºéèŠå¤©ç±» App */
  .app-content { flex: 1; overflow-y: auto; padding: 20px; background: #f2f2f7; }

  /* --- èŠå¤© App ä¸“ç”¨å¸ƒå±€ (ä¿®å¤é®æŒ¡é—®é¢˜) --- */
  #app-chat {
    display: flex;
    flex-direction: column;
    padding: 0; /* æ¸…é™¤é»˜è®¤ paddingï¼Œç”±å†…éƒ¨å…ƒç´ æ§åˆ¶ */
  }

  /* èŠå¤©å†…å®¹å®¹å™¨ï¼šå æ® Header å’Œ TabBar ä¹‹é—´çš„ç©ºé—´ */
  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* é˜²æ­¢æº¢å‡º */
    position: relative;
    background: #f2f2f7;
  }

  /* æ¯ä¸€ä¸ª Tab é¡µé¢çš„æ ·å¼ */
  .chat-tab-view {
    display: none; /* é»˜è®¤éšè— */
    flex-direction: column;
    height: 100%; /* å æ»¡ chat-container */
    width: 100%;
  }
  .chat-tab-view.active {
    display: flex;
  }

  /* æ¶ˆæ¯ Tab ç‰¹æœ‰æ ·å¼ï¼šèŠå¤©è®°å½• + è¾“å…¥æ¡† */
  .chat-messages-area {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  
  /* è¾“å…¥æ¡†åŒºåŸŸï¼šç°åœ¨æ˜¯ Flex å¸ƒå±€çš„ä¸€éƒ¨åˆ†ï¼Œä¸ä¼šè¢«é®æŒ¡ */
  .input-area { 
    flex-shrink: 0; /* ä¸ä¼šè¢«å‹ç¼© */
    padding: 12px 15px;
    padding-bottom: 12px; /* åº•éƒ¨ç•™ç™½ï¼Œå› ä¸ºä¸‹é¢æ˜¯ TabBar */
    background: #fff; 
    display: flex; gap:10px; 
    border-top: 1px solid #eee; 
  }
  .input-area input { flex: 1; height: 40px; padding: 0 15px; border: 1px solid #e0e0e0; border-radius: 20px; font-size: 16px; outline: none; background: #f5f5f5; }
  .input-area input:focus { background: #fff; border-color: #007aff; }

  /* èŠå¤©æ°”æ³¡ */
  .chat-bubble { padding: 12px 18px; border-radius: 20px; max-width: 85%; margin-bottom: 12px; font-size: 16px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
  .chat-bubble.ai { background: #fff; align-self: flex-start; border-bottom-left-radius: 4px; }
  .chat-bubble.me { background: #007aff; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }

  /* èŠå¤©åº•éƒ¨å¯¼èˆªæ  */
  .chat-tab-bar {
    flex-shrink: 0;
    height: calc(50px + env(safe-area-inset-bottom)); /* é€‚é…åº•éƒ¨å®‰å…¨åŒºåŸŸ */
    background: #f8f8f8;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding-top: 8px;
    z-index: 20;
  }
  .chat-tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 10px;
    color: #8e8e93;
    width: 25%;
  }
  .chat-tab-item.active { color: #007aff; }
  .chat-tab-item .icon { font-size: 22px; margin-bottom: 2px; }

  /* --- è®¾ç½® App æ ·å¼ --- */
  .settings-list {
    background: #fff;
  }
  .settings-section {
    background: white;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    overflow: hidden;
  }
  /* è®¾ç½® App å†…çš„äºŒçº§é¡µé¢ */
  .settings-subpage {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #f2f2f7; z-index: 20;
    display: none; flex-direction: column;
    /* padding ç”±å†…éƒ¨ header å’Œ content æ§åˆ¶ */
  }
  .settings-subpage.active { display: flex; animation: slideIn 0.3s ease-out; }
  @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

  .settings-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
    color: #333;
    background: #fff;
  }
  .settings-item:last-child { border-bottom: none; }
  .settings-item:active { background: #f2f2f7; }

  /* è¡¨å•æ§ä»¶ */
  .settings-item input[type="text"], .settings-item input[type="password"], .settings-item select {
    flex-shrink: 0; width: 60%; padding: 8px 10px; border: 1px solid #ccc;
    border-radius: 8px; font-size: 16px; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
  }
  .settings-button {
    background: #007aff; color: white; padding: 12px 20px; border: none;
    border-radius: 10px; font-size: 17px; font-weight: 600; width: 100%;
    text-align: center; margin-top: 20px;
  }

  /* å¼€å…³æ ·å¼ */
  .toggle-switch {
    width: 50px; height: 30px; background: #e9e9ea; border-radius: 15px; position: relative;
    transition: background-color 0.3s;
  }
  .toggle-switch.on { background-color: #34c759; }
  .toggle-switch .slider {
    width: 26px; height: 26px; background: white; border-radius: 50%; position: absolute;
    top: 2px; left: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: left 0.3s;
  }
  .toggle-switch.on .slider { left: 22px; }

  /* åº•éƒ¨é»‘æ¡ */
  .home-bar {
    position: absolute; left: 50%; transform: translateX(-50%);
    width: 130px; height: 5px; background: #fff; border-radius: 3px; z-index: 999; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    bottom: calc(8px + env(safe-area-inset-bottom)); 
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar">
      <span class="carrier-name">AI_Link</span>
      <span id="clock-small">--:--</span>
      <div class="battery-container" id="battery-box">
        <span class="charging-bolt">âš¡</span>
        <span id="batt-text" style="font-size:12px; margin-right:4px;"></span>
        <div class="battery-icon">
          <div class="battery-level" id="batt-level"></div>
        </div>
      </div>
    </div>
    
    <!-- çµåŠ¨å²› -->
    <div class="dynamic-island" id="dynamic-island-display" onclick="toggleDynamicIsland()">
      <img src="https://via.placeholder.com/40x40/007aff/FFFFFF?text=ğŸµ" alt="Album Art" class="album-art" id="album-art">
      <div class="text-content">
        <div class="title" id="song-title">æ­Œæ›²åç§°</div>
        <div class="artist" id="song-artist">è‰ºæœ¯å®¶</div>
      </div>
      <div class="controls">
        <span onclick="event.stopPropagation(); console.log('Previous Track')">â®</span>
        <span onclick="event.stopPropagation(); togglePlayPause()" id="play-pause-btn">â¯</span>
        <span onclick="event.stopPropagation(); console.log('Next Track')">â­</span>
      </div>
    </div>

    <!-- 1. é”å± -->
    <div id="lock-screen" class="page active" onclick="unlock()">
      <div>
        <div class="clock-large" id="clock-large">12:00</div>
        <div class="date-text" id="date-text">10æœˆ24æ—¥ æ˜ŸæœŸäºŒ</div>
      </div>
      <div class="unlock-hint">å‘ä¸Šæ»‘åŠ¨è§£é”</div>
    </div>

    <!-- 2. æ¡Œé¢ -->
    <div id="home-screen" class="page">
      <div class="app-grid">
        <div class="app-item" onclick="openApp('app-chat')">
          <div class="app-icon" style="background: linear-gradient(135deg, #30cfd0, #330867);">ğŸ’¬</div>
          <span class="app-name">èŠå¤©</span>
        </div>
        <div class="app-item" onclick="openApp('app-lore')">
          <div class="app-icon" style="background: linear-gradient(135deg, #d299c2, #fef9d7);">ğŸ“–</div>
          <span class="app-name">ä¸–ç•Œä¹¦</span>
        </div>
        <div class="app-item" onclick="openApp('app-settings')">
          <div class="app-icon" style="background: linear-gradient(135deg, #a1c4fd, #c2e9fb);">âš™ï¸</div>
          <span class="app-name">è®¾ç½®</span>
        </div>
        <div class="app-item">
          <div class="app-icon camera">ğŸ“·</div>
          <span class="app-name">ç›¸æœº</span>
        </div>
      </div>

      <div class="dock">
        <div class="app-item"><div class="app-icon phone">ğŸ“</div><span class="app-name">ç”µè¯</span></div>
        <div class="app-item"><div class="app-icon browser">ğŸŒ</div><span class="app-name">æµè§ˆå™¨</span></div>
        <div class="app-item"><div class="app-icon music">ğŸµ</div><span class="app-name">éŸ³ä¹</span></div>
        <div class="app-item"><div class="app-icon mail">âœ‰ï¸</div><span class="app-name">é‚®ä»¶</span></div>
      </div>
    </div>

    <!-- 3. App: èŠå¤© (é‡æ„å¸ƒå±€) -->
    <div id="app-chat" class="page">
      <!-- èŠå¤© App å¤´éƒ¨ -->
      <div class="app-header">
        <span id="chat-header-title">èŠå¤©</span>
        <!-- å…¨å±€é€€å‡ºé”®ï¼šåœ¨èŠå¤© App é‡Œï¼Œç‚¹å‡»å…³é—­è¿”å›æ¡Œé¢ -->
        <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400; cursor:pointer;">å…³é—­</span>
      </div>
      
      <!-- èŠå¤©å†…å®¹å®¹å™¨ (Tab é¡µé¢) -->
      <div class="chat-container">
        
        <!-- Tab 1: æ¶ˆæ¯ (Flex å¸ƒå±€ä¿®å¤) -->
        <div id="chat-tab-messages" class="chat-tab-view active">
            <!-- æ¶ˆæ¯åˆ—è¡¨ (è‡ªé€‚åº”é«˜åº¦ï¼Œå¯æ»šåŠ¨) -->
            <div class="chat-messages-area" id="chat-box">
                <!-- æ¶ˆæ¯æ°”æ³¡ä¼šåœ¨è¿™é‡Œ -->
            </div>
            <!-- è¾“å…¥æ¡† (å›ºå®šåœ¨åº•éƒ¨ï¼Œä½äº TabBar ä¹‹ä¸Š) -->
            <div class="input-area">
                <input type="text" id="msg-input" placeholder="å‘æ¶ˆæ¯..." onkeydown="if(event.key === 'Enter') sendMsg()">
                <button onclick="sendMsg()" style="border:none; background:none; color:#007aff; font-weight:bold; font-size:16px;">â†‘</button>
            </div>
        </div>

        <!-- Tab 2: è”ç³»äºº -->
        <div id="chat-tab-contacts" class="chat-tab-view" style="padding: 20px; overflow-y: auto;">
            <div class="settings-section">
                <div class="settings-item">AI åŠ©æ‰‹</div>
                <div class="settings-item">çµçŠ€</div>
                <div class="settings-item">å°çˆ±</div>
            </div>
        </div>

        <!-- Tab 3: åŠ¨æ€ -->
        <div id="chat-tab-moments" class="chat-tab-view" style="padding: 20px; text-align: center; color: #888;">
            æš‚æ— åŠ¨æ€ï¼Œå¿«å»åˆ†äº«ä½ çš„ç”Ÿæ´»å§ï¼
        </div>

        <!-- Tab 4: æˆ‘ -->
        <div id="chat-tab-me" class="chat-tab-view" style="padding: 20px; overflow-y: auto;">
            <div class="settings-section">
                <div class="settings-item">æˆ‘çš„æ˜µç§° <span style="color:#888">AI ç”¨æˆ·</span></div>
                <div class="settings-item">æˆ‘çš„è´¦å· <span style="color:#888">12345678</span></div>
            </div>
            <div class="settings-section">
                <div class="settings-item" onclick="clearChatHistory()">
                    <span style="color: #ff3b30;">æ¸…ç©ºèŠå¤©è®°å½•</span>
                </div>
            </div>
        </div>

      </div>

      <!-- èŠå¤© App åº•éƒ¨å¯¼èˆªæ  -->
      <div class="chat-tab-bar" id="chat-tab-bar">
        <div class="chat-tab-item active" data-tab="messages" onclick="switchChatTab('messages')">
          <span class="icon">ğŸ’¬</span> <span>æ¶ˆæ¯</span>
        </div>
        <div class="chat-tab-item" data-tab="contacts" onclick="switchChatTab('contacts')">
          <span class="icon">ğŸ‘¥</span> <span>è”ç³»äºº</span>
        </div>
        <div class="chat-tab-item" data-tab="moments" onclick="switchChatTab('moments')">
          <span class="icon">âœ¨</span> <span>åŠ¨æ€</span>
        </div>
        <div class="chat-tab-item" data-tab="me" onclick="switchChatTab('me')">
          <span class="icon">ğŸ‘¤</span> <span>æˆ‘</span>
        </div>
      </div>
    </div>

    <!-- 4. App: ä¸–ç•Œä¹¦ -->
    <div id="app-lore" class="page">
      <div class="app-header">ä¸–ç•Œä¹¦ <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span></div>
      <div class="app-content">
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05)">
          <strong style="color:#333">è§’è‰²ï¼šçµçŠ€</strong><br>
          <span style="color:#666; font-size:14px">ä½ çš„å…¨èƒ½ AI åŠ©ç†ï¼Œå½“å‰è¿è¡Œåœ¨ WebOS 2.0 ç‰ˆæœ¬ã€‚</span>
        </div>
      </div>
    </div>

    <!-- 5. App: è®¾ç½® (ç³»ç»Ÿè®¾ç½®) -->
    <div id="app-settings" class="page">
      <!-- è®¾ç½®ä¸»é¡µ -->
      <div id="settings-main" style="display: flex; flex-direction: column; height: 100%;">
          <div class="app-header">
            è®¾ç½® <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span>
          </div>
          <div class="app-content" style="background:#f2f2f7; padding: 20px;">
            <div class="settings-section">
                <div class="settings-item">
                  <span>é£è¡Œæ¨¡å¼</span> 
                  <div class="toggle-switch" id="airplane-mode-toggle" onclick="toggleSetting('airplane-mode-toggle')">
                    <div class="slider"></div>
                  </div>
                </div>
                <div class="settings-item">
                  <span>Wi-Fi</span> 
                  <div class="toggle-switch on" id="wifi-toggle" onclick="toggleSetting('wifi-toggle')">
                    <div class="slider"></div>
                  </div>
                </div>
                <div class="settings-item">
                  <span>è“ç‰™</span> 
                  <div class="toggle-switch on" id="bluetooth-toggle" onclick="toggleSetting('bluetooth-toggle')">
                    <div class="slider"></div>
                  </div>
                </div>
            </div>

            <!-- AI é…ç½®å…¥å£ -->
            <div class="settings-section">
                <div class="settings-item" onclick="openSettingsSubpage('settings-ai')">
                    AI é…ç½® <span style="color:#888; font-size: 14px;">URL, Key, æ¨¡å‹ ></span>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-item">é€šç”¨ <span style="color:#888">></span></div>
                <div class="settings-item">å£çº¸ <span style="color:#888">></span></div>
            </div>
          </div>
      </div>

      <!-- è®¾ç½®å­é¡µé¢ï¼šAI é…ç½® -->
      <div id="settings-ai" class="settings-subpage">
          <div class="app-header">
            <span onclick="closeSettingsSubpage('settings-ai')" style="font-size:14px; color:#007aff; font-weight:400; display: flex; align-items: center;"> < è¿”å›</span>
            <span>AI é…ç½®</span>
            <span onclick="goHome()" style="font-size:14px; color:#007aff; font-weight:400">å…³é—­</span>
          </div>
          <div class="app-content" style="padding: 20px;">
            <div class="settings-section">
                <div class="settings-item">
                  <span style="width: 80px;">API URL</span>
                  <input type="text" id="api-url-input" placeholder="http://...">
                </div>
                <div class="settings-item">
                  <span style="width: 80px;">API Key</span>
                  <input type="password" id="api-key-input" placeholder="sk-...">
                </div>
                <div class="settings-item">
                  <span style="width: 80px;">æ¨¡å‹</span>
                  <select id="ai-model-select"></select>
                </div>
            </div>
            <button class="settings-button" onclick="saveAiSettings()">ä¿å­˜é…ç½®</button>
            <p style="color: #888; font-size: 12px; margin-top: 10px; text-align: center;">é…ç½®å°†ç”¨äºâ€œèŠå¤©â€App çš„ AI å›å¤ã€‚</p>
          </div>
      </div>
    </div>

    <div class="home-bar" onclick="goHome()"></div>
  </div>
</div>

<script>
  // ====================================================================
  // 1. å…¨å±€ç³»ç»ŸåŠŸèƒ½
  // ====================================================================

  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('clock-small').innerText = `${h}:${m}`;
    document.getElementById('clock-large').innerText = `${h}:${m}`;
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    document.getElementById('date-text').innerText = `${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${weekDays[now.getDay()]}`;
  }
  setInterval(updateClock, 1000);
  updateClock();

  function initBattery() {
    const battLevelEl = document.getElementById('batt-level');
    const battTextEl = document.getElementById('batt-text');
    const battBoxEl = document.getElementById('battery-box');
    if (navigator.getBattery) {
      navigator.getBattery().then(battery => {
        updateBatteryUI(battery);
        battery.addEventListener('levelchange', () => updateBatteryUI(battery));
        battery.addEventListener('chargingchange', () => updateBatteryUI(battery));
      });
    } else {
      battLevelEl.style.width = '85%'; battTextEl.innerText = '85%';
    }
    function updateBatteryUI(battery) {
      const level = Math.floor(battery.level * 100);
      battLevelEl.style.width = `${level}%`;
      battTextEl.innerText = `${level}%`;
      if(battery.charging) battBoxEl.classList.add('charging');
      else battBoxEl.classList.remove('charging');
    }
  }
  initBattery();

  // --- App åˆ‡æ¢é€»è¾‘ ---
  let currentApp = 'lock-screen';

  function unlock() {
    const lock = document.getElementById('lock-screen');
    lock.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
    lock.style.transform = 'translateY(-100%)';
    setTimeout(() => {
      lock.classList.remove('active');
      lock.style.transform = '';
      document.getElementById('home-screen').classList.add('active');
      currentApp = 'home-screen';
    }, 400);
  }

  function openApp(id) {
    const activePage = document.querySelector('.page.active');
    if (activePage) activePage.classList.remove('active');
    document.getElementById(id).classList.add('active');
    currentApp = id;
    if (id === 'app-chat') {
        loadChatHistory();
        scrollChatToBottom();
        switchChatTab('messages'); 
    }
    if (id === 'app-settings') {
        // é‡ç½®è®¾ç½®é¡µé¢åˆ°ä¸»é¡µ
        document.querySelectorAll('.settings-subpage').forEach(p => p.classList.remove('active'));
    }
  }

  function goHome() {
    const activePage = document.querySelector('.page.active');
    if (activePage && activePage.id !== 'home-screen' && activePage.id !== 'lock-screen') {
      activePage.style.transition = 'transform 0.3s cubic-bezier(0.55, 0.085, 0.68, 0.53), opacity 0.3s ease-out';
      activePage.style.transform = 'scale(0.9)';
      activePage.style.opacity = '0';
      setTimeout(() => {
        activePage.classList.remove('active');
        activePage.style = '';
      }, 300);
    }
    document.getElementById('home-screen').classList.add('active');
    currentApp = 'home-screen';
  }

  // --- çµåŠ¨å²›é€»è¾‘ (ç®€åŒ–) ---
  let isPlaying = false;
  function toggleDynamicIsland() {
    const di = document.getElementById('dynamic-island-display');
    if(isPlaying) di.classList.toggle('expanded');
  }
  function togglePlayPause() {
    isPlaying = !isPlaying;
    document.getElementById('play-pause-btn').innerText = isPlaying ? 'â¸' : 'â¯';
    if(isPlaying) document.getElementById('dynamic-island-display').classList.add('expanded');
  }

  // ====================================================================
  // 2. èŠå¤© App åŠŸèƒ½
  // ====================================================================

  let chatHistory = [];
  const chatBox = document.getElementById('chat-box');
  
  // API é…ç½®å­˜å‚¨
  let apiSettings = JSON.parse(localStorage.getItem('chatApiSettings')) || { url: '', key: '', model: '' };
  const availableModels = [
    { id: 'gpt-3.5-turbo', name: 'GPT-3.5 Turbo' },
    { id: 'gpt-4o', name: 'GPT-4o' },
    { id: 'kimi', name: 'Kimi' }
  ];

  function loadChatHistory() {
    const storedHistory = localStorage.getItem('aiChatHistory');
    chatBox.innerHTML = '';
    if (storedHistory) {
      chatHistory = JSON.parse(storedHistory);
      chatHistory.forEach(msg => {
        chatBox.innerHTML += `<div class="chat-bubble ${msg.sender}">${msg.text}</div>`;
      });
    } else {
      addMessageToChat('ai', 'ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI åŠ©æ‰‹ã€‚');
    }
  }

  function scrollChatToBottom() {
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  async function sendMsg() {
    const input = document.getElementById('msg-input');
    const val = input.value.trim();
    if(!val) return;
    
    addMessageToChat('me', val);
    input.value = '';
    scrollChatToBottom();

    setTimeout(() => {
      let aiText = '';
      if (apiSettings.url && apiSettings.key) {
        aiText = `(æ¨¡æ‹Ÿè°ƒç”¨ API: ${apiSettings.model}) æ”¶åˆ°æ¶ˆæ¯ï¼š${val}`;
      } else {
        aiText = "è¯·å…ˆåœ¨â€œè®¾ç½®â€App ä¸­é…ç½® AI APIã€‚";
      }
      addMessageToChat('ai', aiText);
      scrollChatToBottom();
    }, 600);
  }

  function addMessageToChat(sender, text) {
    chatBox.innerHTML += `<div class="chat-bubble ${sender}">${text}</div>`;
    chatHistory.push({ sender, text });
    localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
  }

  function clearChatHistory() {
    if (confirm("ç¡®å®šæ¸…ç©ºèŠå¤©è®°å½•ï¼Ÿ")) {
      chatHistory = [];
      localStorage.removeItem('aiChatHistory');
      chatBox.innerHTML = '';
      alert('å·²æ¸…ç©º');
    }
  }

  function switchChatTab(tabName) {
    document.querySelectorAll('.chat-tab-view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.chat-tab-item').forEach(i => i.classList.remove('active'));
    
    document.getElementById(`chat-tab-${tabName}`).classList.add('active');
    document.querySelector(`.chat-tab-item[data-tab="${tabName}"]`).classList.add('active');
    
    // æ›´æ–°æ ‡é¢˜
    const titles = { messages: 'èŠå¤©', contacts: 'è”ç³»äºº', moments: 'åŠ¨æ€', me: 'æˆ‘' };
    document.getElementById('chat-header-title').innerText = titles[tabName];
    
    if (tabName === 'messages') scrollChatToBottom();
  }

  // ====================================================================
  // 3. è®¾ç½® App åŠŸèƒ½ (å« AI é…ç½®)
  // ====================================================================

  function toggleSetting(id) {
    document.getElementById(id).classList.toggle('on');
  }

  function openSettingsSubpage(id) {
    document.getElementById(id).classList.add('active');
    if (id === 'settings-ai') loadAiSettings();
  }

  function closeSettingsSubpage(id) {
    document.getElementById(id).classList.remove('active');
  }

  function loadAiSettings() {
    document.getElementById('api-url-input').value = apiSettings.url;
    document.getElementById('api-key-input').value = apiSettings.key;
    const select = document.getElementById('ai-model-select');
    select.innerHTML = '';
    availableModels.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m.id; opt.innerText = m.name;
      select.appendChild(opt);
    });
    select.value = apiSettings.model;
  }

  function saveAiSettings() {
    apiSettings.url = document.getElementById('api-url-input').value.trim();
    apiSettings.key = document.getElementById('api-key-input').value.trim();
    apiSettings.model = document.getElementById('ai-model-select').value;
    localStorage.setItem('chatApiSettings', JSON.stringify(apiSettings));
    alert('AI é…ç½®å·²ä¿å­˜ï¼');
    closeSettingsSubpage('settings-ai');
  }

</script>
</body>
</html>
